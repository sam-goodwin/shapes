(()=>{"use strict";const e=function(e,t){if("function"==typeof e)return function(){return e(arguments)?t.apply(this,arguments):e=>t(e,...arguments)};switch(e){case 0:case 1:throw new RangeError(`Invalid arity ${e}`);case 2:return function(e,r){return arguments.length>=2?t(e,r):function(r){return t(r,e)}};case 3:return function(e,r,n){return arguments.length>=3?t(e,r,n):function(n){return t(n,e,r)}};case 4:return function(e,r,n,s){return arguments.length>=4?t(e,r,n,s):function(s){return t(s,e,r,n)}};case 5:return function(e,r,n,s,i){return arguments.length>=5?t(e,r,n,s,i):function(i){return t(i,e,r,n,s)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);const r=arguments;return function(e){return t(e,...r)}}}},t=e=>e,r=e=>()=>e,n=r(!0),s=r(!1),i=r(void 0);function a(e,t,r,n,s,i,a,o,c){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return r(t(e));case 4:return n(r(t(e)));case 5:return s(n(r(t(e))));case 6:return i(s(n(r(t(e)))));case 7:return a(i(s(n(r(t(e))))));case 8:return o(a(i(s(n(r(t(e)))))));case 9:return c(o(a(i(s(n(r(t(e))))))));default:{let e=arguments[0];for(let t=1;t<arguments.length;t++)e=arguments[t](e);return e}}}const o="2.0.0-next.58",c=Symbol.for(`effect/GlobalValue/globalStoreId/${o}`);c in globalThis||(globalThis[c]=new Map);const u=globalThis[c],l=(e,t)=>(u.has(e)||u.set(e,t()),u.get(e)),f=e=>"string"==typeof e,h=e=>"number"==typeof e,g=e=>"boolean"==typeof e,p=e=>"bigint"==typeof e,m=e=>"symbol"==typeof e,d=e=>"function"==typeof e,y=e=>void 0===e,b=e=>!1,_=e=>"object"==typeof e&&null!==e,S=e=>_(e)||d(e),w=e(2,((e,t)=>S(e)&&t in e)),v=e(2,((e,t)=>w(e,"_tag")&&e._tag===t)),k=e=>null==e,O=e=>null!=e,I=e=>_(e)&&!Array.isArray(e);Symbol.iterator,Symbol.iterator;class N{_state;constructor(e,t,r,n){return k(t)&&k(e)?(t=4294967295*Math.random()>>>0,e=0):k(t)&&(t=e,e=0),k(n)&&k(r)?(n=this._state?this._state[3]:4150755663,r=this._state?this._state[2]:335903614):k(n)&&(n=r,r=0),this._state=new Int32Array([0,0,r>>>0,(1|(n||0))>>>0]),this._next(),x(this._state,this._state[0],this._state[1],e>>>0,t>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(e){this._state[0]=e[0],this._state[1]=e[1],this._state[2]=e[2],this._state[3]=1|e[3]}integer(e){if(!e)return this._next();if(0==((e>>>=0)&e-1))return this._next()&e-1;let t=0;const r=(-e>>>0)%e>>>0;for(t=this._next();t<r;t=this._next());return t%e}number(){return(1*(67108863&this._next())*134217728+1*(134217727&this._next()))/9007199254740992}_next(){const e=this._state[0]>>>0,t=this._state[1]>>>0;!function(e,t,r,n,s){let i=32557*(r>>>16)>>>0,a=19605*(65535&r)>>>0,o=32557*(65535&r)>>>0,c=19605*(r>>>16)+((a>>>16)+(i>>>16))>>>0;a=a<<16>>>0,o=o+a>>>0,o>>>0<a>>>0&&(c=c+1>>>0),i=i<<16>>>0,o=o+i>>>0,o>>>0<i>>>0&&(c=c+1>>>0),c=c+Math.imul(r,1481765933)>>>0,c=c+Math.imul(t,s)>>>0,e[0]=c,e[1]=o}(this._state,e,t,0,1284865837),x(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=e>>>18,n=(t>>>18|e<<14)>>>0;r=(r^e)>>>0,n=(n^t)>>>0;const s=(n>>>27|r<<5)>>>0,i=e>>>27;return(s>>>i|s<<((-i>>>0&31)>>>0))>>>0}}function x(e,t,r,n,s){let i=t+n>>>0;const a=r+s>>>0;a>>>0<r>>>0&&(i=i+1|0),e[0]=i,e[1]=a}const T=l(Symbol.for("effect/Hash/randomHashCache"),(()=>new WeakMap)),F=l(Symbol.for("effect/Hash/pcgr"),(()=>new N)),M=Symbol.for("effect/Hash"),R=e=>{switch(typeof e){case"number":return L(e);case"bigint":return K(e.toString(10));case"boolean":case"symbol":return K(String(e));case"string":return K(e);case"undefined":return K("undefined");case"function":case"object":return null===e?K("null"):j(e)?e[M]():E(e);default:throw new Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},E=e=>(T.has(e)||T.set(e,L(F.integer(Number.MAX_SAFE_INTEGER))),T.get(e)),C=e=>t=>53*t^e,A=e=>3221225471&e|e>>>1&1073741824,j=e=>w(e,M),L=e=>{if(e!=e||e===1/0)return 0;let t=0|e;for(t!==e&&(t^=4294967295*e);e>4294967295;)t^=e/=4294967295;return A(e)},K=e=>{let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return A(t)},P=e=>((e,t)=>{let r=12289;for(let n=0;n<t.length;n++)r^=a(K(t[n]),C(R(e[t[n]])));return A(r)})(e,Object.keys(e)),B=e=>{let t=6151;for(let r=0;r<e.length;r++)t=a(t,C(R(e[r])));return A(t)},q=Symbol.for("effect/Equal");function $(){return 1===arguments.length?e=>J(e,arguments[0]):J(arguments[0],arguments[1])}function J(e,t){if(e===t)return!0;const r=typeof e;return r===typeof t&&!("object"!==r&&"function"!==r||null===e||null===t||!U(e)||!U(t))&&R(e)===R(t)&&e[q](t)}const U=e=>w(e,q),D=()=>(e,t)=>$(e,t),z=e=>(t,r)=>t===r||e(t,r),V=e(2,((e,t)=>z(((r,n)=>e(t(r),t(n)))))),G=Symbol.for("nodejs.util.inspect.custom"),H=e=>w(e,"toJSON")&&d(e.toJSON)&&0===e.toJSON.length?e.toJSON():Array.isArray(e)?e.map(H):e,W=e=>JSON.stringify(e,null,2),Y=(e,t)=>{switch(t.length){case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let r=e;for(let e=0,n=t.length;e<n;e++)r=t[e](r);return r}}},Q=Symbol.for("effect/Duration"),X=BigInt(1e3),Z=BigInt(1e9),ee=/^(-?\d+(?:\.\d+)?)\s+(nanos|micros|millis|seconds|minutes|hours|days|weeks)$/,te=e=>{if(ae(e))return e;if(h(e))return le(e);if(p(e))return ce(e);if(Array.isArray(e)){if(2===e.length&&h(e[0])&&h(e[1]))return ce(BigInt(e[0])*Z+BigInt(e[1]))}else{ee.lastIndex=0;const t=ee.exec(e);if(t){const[e,r,n]=t,s=Number(r);switch(n){case"nanos":return ce(BigInt(r));case"micros":return ue(BigInt(r));case"millis":return le(s);case"seconds":return fe(s);case"minutes":return he(s);case"hours":return ge(s);case"days":return pe(s);case"weeks":return me(s)}}}throw new Error("Invalid duration input")},re={_tag:"Millis",millis:0},ne={_tag:"Infinity"},se={[Q]:Q,[M](){return P(this.value)},[q](e){return ae(e)&&Se(this,e)},toString(){return`Duration(${we(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:ye(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[G](){return this.toJSON()},pipe(){return Y(this,arguments)}},ie=e=>{const t=Object.create(se);return h(e)?isNaN(e)||e<0?t.value=re:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(1e6*e))}:t.value=ne:e<BigInt(0)?t.value=re:t.value={_tag:"Nanos",nanos:e},t},ae=e=>w(e,Q),oe=ie(0),ce=e=>ie(e),ue=e=>ie(e*X),le=e=>ie(e),fe=e=>ie(1e3*e),he=e=>ie(6e4*e),ge=e=>ie(36e5*e),pe=e=>ie(864e5*e),me=e=>ie(6048e5*e),de=e=>{const t=te(e);switch(t.value._tag){case"Infinity":return 1/0;case"Nanos":return Number(t.value.nanos)/1e6;case"Millis":return t.value.millis}},ye=e=>{const t=te(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/Z),Number(t.value.nanos%Z)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},be=e(3,((e,t,r)=>{const n=te(e),s=te(t);if("Infinity"===n.value._tag||"Infinity"===s.value._tag)return r.onMillis(de(n),de(s));if("Nanos"===n.value._tag||"Nanos"===s.value._tag){const e="Nanos"===n.value._tag?n.value.nanos:BigInt(Math.round(1e6*n.value.millis)),t="Nanos"===s.value._tag?s.value.nanos:BigInt(Math.round(1e6*s.value.millis));return r.onNanos(e,t)}return r.onMillis(n.value.millis,s.value.millis)})),_e=e(2,((e,t)=>be(e,t,{onMillis:(e,t)=>e>=t,onNanos:(e,t)=>e>=t}))),Se=e(2,((e,t)=>((e,t)=>be(e,t,{onMillis:(e,t)=>e===t,onNanos:(e,t)=>e===t}))(te(e),te(t)))),we=e=>{const t=te(e),r=[];if("Infinity"===t.value._tag)return"Infinity";const n=(e=>{const t=te(e);switch(t.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(1e6*t.value.millis))}})(t);n%1000000n&&r.push(n%1000000n+"ns");const s=n/1000000n;s%1000n!==0n&&r.push(s%1000n+"ms");const i=s/1000n;i%60n!==0n&&r.push(i%60n+"s");const a=i/60n;a%60n!==0n&&r.push(a%60n+"m");const o=a/60n;o%24n!==0n&&r.push(o%24n+"h");const c=o/24n;return 0n!==c&&r.push(`${c}d`),r.reverse().join(" ")},ve="Async",ke="Commit",Oe="Failure",Ie="OnFailure",Ne="OnSuccess",xe="OnSuccessAndFailure",Te="Success",Fe="Sync",Me="UpdateRuntimeFlags",Re="While",Ee="WithRuntime",Ce="Yield",Ae="RevertFlags",je=Symbol.for("effect/Effect"),Le=Symbol.for("effect/Stream"),Ke=Symbol.for("effect/Sink"),Pe=Symbol.for("effect/Channel"),Be={_R:e=>e,_E:e=>e,_A:e=>e,_V:o},qe={[je]:Be,[Le]:Be,[Ke]:{_R:e=>e,_E:e=>e,_In:e=>e,_L:e=>e,_Z:e=>e},[Pe]:{_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},[q](e){return this===e},[M](){return E(this)},pipe(){return Y(this,arguments)}},$e={[M](){return P(this)},[q](e){const t=Object.keys(this),r=Object.keys(e);if(t.length!==r.length)return!1;for(const r of t)if(!(r in e)||!$(this[r],e[r]))return!1;return!0}},Je={...qe,_op:ke},Ue={...Je,...$e},De=Symbol.for("effect/Option"),ze={...qe,[De]:{_A:e=>e},[G](){return this.toJSON()},toString(){return W(this.toJSON())}},Ve=Object.assign(Object.create(ze),{_tag:"Some",_op:"Some",[q](e){return He(e)&&Ye(e)&&$(e.value,this.value)},[M](){return C(R(this._tag))(R(this.value))},toJSON(){return{_id:"Option",_tag:this._tag,value:H(this.value)}}}),Ge=Object.assign(Object.create(ze),{_tag:"None",_op:"None",[q]:e=>He(e)&&We(e),[M](){return C(R(this._tag))},toJSON(){return{_id:"Option",_tag:this._tag}}}),He=e=>w(e,De),We=e=>"None"===e._tag,Ye=e=>"Some"===e._tag,Qe=Object.create(Ge),Xe=e=>{const t=Object.create(Ve);return t.value=e,t},Ze=Symbol.for("effect/Either"),et={...qe,[Ze]:{_A:e=>e},[G](){return this.toJSON()},toString(){return W(this.toJSON())}},tt=Object.assign(Object.create(et),{_tag:"Right",_op:"Right",[q](e){return nt(e)&&it(e)&&$(e.right,this.right)},[M](){return C(R(this._tag))(R(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:H(this.right)}}}),rt=Object.assign(Object.create(et),{_tag:"Left",_op:"Left",[q](e){return nt(e)&&st(e)&&$(e.left,this.left)},[M](){return C(R(this._tag))(R(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:H(this.left)}}}),nt=e=>w(e,Ze),st=e=>"Left"===e._tag,it=e=>"Right"===e._tag,at=e=>{const t=Object.create(tt);return t.right=e,t},ot=e=>{const t=Object.create(rt);return t.left=e,t},ct=st,ut=it,lt=e(2,((e,{onLeft:t,onRight:r})=>ct(e)?t(e.left):r(e.right)))({onLeft:t,onRight:t}),ft=()=>Qe,ht=Xe,gt=He,pt=We,mt=Ye,dt=e(2,((e,{onNone:t,onSome:r})=>pt(e)?t():r(e.value))),yt=e(2,((e,t)=>pt(e)?t():e.value)),bt=e(2,((e,t)=>pt(e)?t():e)),_t=e=>null==e?ft():ht(e),St=yt(i),wt=e(2,((e,t)=>pt(e)?ft():ht(t(e.value)))),vt=e(2,((e,t)=>pt(e)?ft():t(e.value))),kt=vt(t),Ot=e=>z(((t,r)=>t===r||(pt(t)?pt(r):!pt(r)&&e(t.value,r.value)))),It=(t=>e(2,((e,r)=>!pt(e)&&t(e.value,r))))(D()),Nt=e=>e.length>0,xt=e=>(t,r)=>t===r?0:e(t,r),Tt=xt(((e,t)=>e<t?-1:1)),Ft=e=>xt(((t,r)=>e(r,t))),Mt=e(2,((e,t)=>xt(((r,n)=>e(t(r),t(n)))))),Rt=(...e)=>{return t=e,xt(((e,r)=>{const n=Math.min(e.length,r.length);let s=0;for(const i of t){if(s>=n)break;const t=i(e[s],r[s]);if(0!==t)return t;s++}return 0}));var t},Et=t=>e(2,((e,r)=>1===t(e,r))),Ct=t=>e(2,((e,r)=>e===r||t(e,r)>-1?e:r)),At=(...e)=>e,jt=e=>Array.isArray(e)?e:Array.from(e),Lt=e(2,((e,t)=>[t,...e])),Kt=e(2,((e,t)=>[...e,t])),Pt=e=>0===e.length,Bt=Nt,qt=Nt,$t=(e,t)=>e<0||e>=t.length,Jt=e(2,((e,t)=>{const r=Math.floor(t);return $t(r,e)?ft():ht(e[r])})),Ut=e(2,((e,t)=>{const r=Math.floor(t);if($t(r,e))throw new Error(`Index ${r} out of bounds`);return e[r]})),Dt=Jt(0),zt=Ut(0),Vt=e=>e.slice(1),Gt=e=>Array.from(e).reverse(),Ht=e(2,((e,t)=>{const r=Array.from(e);return r.sort(t),r})),Wt=e(2,((e,t)=>Yt(e,t,At))),Yt=e(3,((e,t,r)=>{const n=jt(e),s=jt(t);if(qt(n)&&qt(s)){const e=[r(zt(n),zt(s))],t=Math.min(n.length,s.length);for(let i=1;i<t;i++)e[i]=r(n[i],s[i]);return e}return[]})),Qt=e=>[e],Xt=e(2,((e,t)=>e.map(t))),Zt=e(2,((e,t)=>{if(Pt(e))return[];const r=[];for(let n=0;n<e.length;n++)r.push(...t(e[n],n));return r})),er=Zt(t),tr=e(3,((e,t,r)=>jt(e).reduce(((e,t,n)=>r(e,t,n)),t))),rr=(e,t)=>{const r=[];let n,s=e;for(;mt(n=t(s));){const[e,t]=n.value;r.push(e),s=t}return r},nr=e(2,((e,t)=>{const r=jt(e);if(qt(r)){const e=[zt(r)],n=Vt(r);for(const r of n)e.every((e=>!t(r,e)))&&e.push(r);return e}return[]}))(D()),sr=e(2,((e,t)=>jt(e).join(t))),ir=Tt,ar=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return ar(e,t.from)}},or=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),cr=e=>{let t,r=!1;return()=>(r||(t=e(),r=!0),t)},ur=Symbol.for("@effect/schema/annotation/Type"),lr=Symbol.for("@effect/schema/annotation/Message"),fr=Symbol.for("@effect/schema/annotation/Identifier"),hr=Symbol.for("@effect/schema/annotation/Title"),gr=Symbol.for("@effect/schema/annotation/Description"),pr=Symbol.for("@effect/schema/annotation/JSONSchema"),mr=e=>t=>Object.prototype.hasOwnProperty.call(t.annotations,e)?ht(t.annotations[e]):ft(),dr=mr(lr),yr=mr(hr),br=mr(fr),_r=mr(gr),Sr=(e,t,r,n={})=>({_tag:"Declaration",typeParameters:e,type:t,decode:r,annotations:n}),wr=(e,t={})=>({_tag:"Literal",literal:e,annotations:t}),vr=e=>"Literal"===e._tag,kr={_tag:"NeverKeyword",annotations:{[hr]:"never"}},Or={_tag:"UnknownKeyword",annotations:{[hr]:"unknown"}},Ir=e=>"UnknownKeyword"===e._tag,Nr={_tag:"AnyKeyword",annotations:{[hr]:"any"}},xr=e=>"AnyKeyword"===e._tag,Tr={_tag:"StringKeyword",annotations:{[hr]:"string",[gr]:"a string"}},Fr=e=>"StringKeyword"===e._tag,Mr={_tag:"NumberKeyword",annotations:{[hr]:"number",[gr]:"a number"}},Rr=e=>"NumberKeyword"===e._tag,Er=e=>"BooleanKeyword"===e._tag,Cr=e=>"BigIntKeyword"===e._tag,Ar=e=>"SymbolKeyword"===e._tag,jr=(e,t)=>({type:e,isOptional:t}),Lr=(e,t,r,n={})=>({_tag:"Tuple",elements:e,rest:t,isReadonly:r,annotations:n}),Kr=(e,t,r,n,s={})=>({name:e,type:t,isOptional:r,isReadonly:n,annotations:s}),Pr=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return Pr(e.from);default:return!1}},Br=(e,t,r)=>{if(Pr(e))return{parameter:e,type:t,isReadonly:r};throw new Error("An index signature parameter type must be 'string', 'symbol', a template literal type or a refinement of the previous types")},qr=(e,t,r={})=>{const n={};for(let t=0;t<e.length;t++){const r=e[t].name;if(Object.prototype.hasOwnProperty.call(n,r))throw new Error(`Duplicate property signature ${String(r)}`);n[r]=null}const s={string:!1,symbol:!1};for(let e=0;e<t.length;e++){const r=sn(t[e].parameter);if(Fr(r)){if(s.string)throw new Error("Duplicate index signature for type `string`");s.string=!0}else if(Ar(r)){if(s.symbol)throw new Error("Duplicate index signature for type `symbol`");s.symbol=!0}}return{_tag:"TypeLiteral",propertySignatures:Qr(e),indexSignatures:t,annotations:r}},$r=(e,t={})=>{const r=nn(e);return r.length>1?{_tag:"Union",types:rn(r),annotations:t}:qt(r)?r[0]:kr},Jr=(e,t={})=>({_tag:"Lazy",f:cr(e),annotations:t}),Ur=(e,t,r={})=>zr(e)?Dr(e.from,Ur(e.to,t,r),e.transformation,e.annotations):{_tag:"Refinement",from:e,filter:t,annotations:r},Dr=(e,t,r,n={})=>({_tag:"Transform",from:e,to:t,transformation:r,annotations:n}),zr=e=>"Transform"===e._tag,Vr=(e,t)=>({_tag:"FinalPropertySignatureTransformation",decode:e,encode:t}),Gr=(e,t,r)=>({from:e,to:t,propertySignatureTransformation:r}),Hr=e=>{switch(e._tag){case"Declaration":return Sr(e.typeParameters.map(Hr),Hr(e.type),e.decode,e.annotations);case"Tuple":return Lr(e.elements.map((e=>jr(Hr(e.type),e.isOptional))),wt(e.rest,Xt(Hr)),e.isReadonly,e.annotations);case"TypeLiteral":return qr(e.propertySignatures.map((e=>Kr(e.name,Hr(e.type),e.isOptional,e.isReadonly,e.annotations))),e.indexSignatures.map((e=>Br(e.parameter,Hr(e.type),e.isReadonly))),e.annotations);case"Union":return $r(e.types.map(Hr),e.annotations);case"Lazy":return Jr((()=>Hr(e.f())),e.annotations);case"Refinement":return Ur(Hr(e.from),e.filter,e.annotations);case"Transform":return Hr(e.to)}return e},Wr=e=>{switch(e._tag){case"Declaration":return Sr(e.typeParameters.map(Wr),Wr(e.type),e.decode,e.annotations);case"Tuple":return Lr(e.elements.map((e=>jr(Wr(e.type),e.isOptional))),wt(e.rest,Xt(Wr)),e.isReadonly);case"TypeLiteral":return qr(e.propertySignatures.map((e=>Kr(e.name,Wr(e.type),e.isOptional,e.isReadonly))),e.indexSignatures.map((e=>Br(e.parameter,Wr(e.type),e.isReadonly))));case"Union":return $r(e.types.map(Wr));case"Lazy":return Jr((()=>Wr(e.f())));case"Refinement":case"Transform":return Wr(e.from)}return e},Yr=e=>{switch(e._tag){case"Declaration":return Yr(e.type);case"NeverKeyword":return 0;case"Literal":case"UndefinedKeyword":case"VoidKeyword":case"UniqueSymbol":return 1;case"BooleanKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3;case"ObjectKeyword":return 5;case"UnknownKeyword":case"AnyKeyword":return 6;default:return 4}},Qr=Ht(a(ir,Mt((e=>Yr(e.type))))),Xr=Rt(ir,ir,ir),Zr=Ct(Xr),en=[0,0,0],tn=e=>{switch(e._tag){case"Tuple":return[2,e.elements.length,mt(e.rest)?e.rest.value.length:0];case"TypeLiteral":{const t=e.propertySignatures.length,r=e.indexSignatures.length;return t+r===0?[-4,0,0]:[4,t,r]}case"Declaration":{const[t,r,n]=tn(e.type);return[6,r,n]}case"Lazy":return[8,0,0];case"Union":return e.types.map(tn).reduce(Zr,en);case"Refinement":{const[t,r,n]=tn(e.from);return[t+1,r,n]}case"Transform":return tn(e.from);case"ObjectKeyword":return[-2,0,0];case"UnknownKeyword":case"AnyKeyword":return[-4,0,0];default:return en}},rn=Ht(Ft(Mt(Xr,tn))),nn=e=>{let t,r=a(e,Zt((e=>{switch(e._tag){case"NeverKeyword":return[];case"Union":return e.types;default:return[e]}})));return r.some(xr)?[Nr]:r.some(Ir)?[Or]:(-1!==(t=r.findIndex(Fr))&&(r=r.filter(((e,r)=>r===t||!Fr(e)&&!(vr(e)&&"string"==typeof e.literal)))),-1!==(t=r.findIndex(Rr))&&(r=r.filter(((e,r)=>r===t||!Rr(e)&&!(vr(e)&&"number"==typeof e.literal)))),-1!==(t=r.findIndex(Er))&&(r=r.filter(((e,r)=>r===t||!Er(e)&&!(vr(e)&&"boolean"==typeof e.literal)))),-1!==(t=r.findIndex(Cr))&&(r=r.filter(((e,r)=>r===t||!Cr(e)&&!(vr(e)&&"bigint"==typeof e.literal)))),-1!==(t=r.findIndex(Ar))&&(r=r.filter(((e,r)=>r===t||!Ar(e)&&!("UniqueSymbol"===e._tag)))),r)},sn=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return sn(e.from)}},an=Symbol.for("@effect/schema/TypeId/GreaterThan"),on=Symbol.for("@effect/schema/TypeId/GreaterThanOrEqualTo"),cn=Symbol.for("@effect/schema/TypeId/LessThan"),un=Symbol.for("@effect/schema/TypeId/LessThanOrEqualTo"),ln=Symbol.for("@effect/schema/TypeId/Int"),fn=Symbol.for("@effect/schema/TypeId/Between"),hn=Symbol.for("@effect/schema/TypeId/GreaterThanBigint"),gn=Symbol.for("@effect/schema/TypeId/GreaterThanOrEqualToBigint"),pn=Symbol.for("@effect/schema/TypeId/LessThanBigint"),mn=Symbol.for("@effect/schema/TypeId/LessThanOrEqualToBigint"),dn=Symbol.for("@effect/schema/TypeId/BetweenBigint"),yn=Symbol.for("@effect/schema/TypeId/MinLength"),bn=Symbol.for("@effect/schema/TypeId/MaxLength"),_n=Symbol.for("@effect/schema/TypeId/Length"),Sn=Symbol.for("@effect/schema/TypeId/MinItems"),wn=Symbol.for("@effect/schema/TypeId/MaxItems"),vn=Symbol.for("@effect/schema/TypeId/ItemsCount"),kn=Symbol.for("@effect/schema/ArbitraryHookId"),On=Symbol.for("@effect/schema/PrettyHookId"),In=Symbol.for("@effect/schema/EquivalenceHookId"),Nn=Symbol.for("effect/Chunk"),xn=[],Tn=(e=>z(((t,r)=>t.length===r.length&&Kn(t).every(((t,n)=>e(t,$n(r,n)))))))($),Fn={[Nn]:{_A:e=>e},toString(){return W(this.toJSON())},toJSON(){return{_id:"Chunk",values:Kn(this).map(H)}},[G](){return this.toJSON()},[q](e){return Rn(e)&&Tn(this,e)},[M](){return B(Kn(this))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return xn[Symbol.iterator]();default:return Kn(this)[Symbol.iterator]()}},pipe(){return Y(this,arguments)}},Mn=e=>{const t=Object.create(Fn);switch(t.backing=e,e._tag){case"IEmpty":t.length=0,t.depth=0,t.left=t,t.right=t;break;case"IConcat":t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break;case"IArray":t.length=e.array.length,t.depth=0,t.left=En,t.right=En;break;case"ISingleton":t.length=1,t.depth=0,t.left=En,t.right=En;break;case"ISlice":t.length=e.length,t.depth=e.chunk.depth+1,t.left=En,t.right=En}return t},Rn=e=>w(e,Nn),En=Mn({_tag:"IEmpty"}),Cn=()=>En,An=e=>Mn({_tag:"ISingleton",a:e}),jn=e=>Rn(e)?e:Mn({_tag:"IArray",array:jt(e)}),Ln=(e,t,r)=>{switch(e.backing._tag){case"IArray":!function(e,t,r,n,s){for(let t=0;t<Math.min(e.length,0+s);t++)r[n+t-0]=e[t]}(e.backing.array,0,t,r,e.length);break;case"IConcat":Ln(e.left,t,r),Ln(e.right,t,r+e.left.length);break;case"ISingleton":t[r]=e.backing.a;break;case"ISlice":{let n=0,s=r;for(;n<e.length;)t[s]=$n(e,n),n+=1,s+=1;break}}},Kn=e=>{switch(e.backing._tag){case"IEmpty":return xn;case"IArray":return e.backing.array;default:{const t=new Array(e.length);return Ln(e,t,0),e.backing={_tag:"IArray",array:t},e.left=En,e.right=En,e.depth=0,t}}},Pn=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return Mn({_tag:"IArray",array:Gt(e.backing.array)});case"IConcat":return Mn({_tag:"IConcat",left:Pn(e.backing.right),right:Pn(e.backing.left)});case"ISlice":return qn(Gt(Kn(e)))}},Bn=e(2,((e,t)=>t<0||t>=e.length?ft():ht($n(e,t)))),qn=e=>Mn({_tag:"IArray",array:e}),$n=e(2,((e,t)=>{switch(e.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":if(0!==t)throw new Error("Index out of bounds");return e.backing.a;case"IArray":if(t>=e.length||t<0)throw new Error("Index out of bounds");return e.backing.array[t];case"IConcat":return t<e.left.length?$n(e.left,t):$n(e.right,t-e.left.length);case"ISlice":return $n(e.backing.chunk,t+e.backing.offset)}})),Jn=e(2,((e,t)=>Vn(e,An(t)))),Un=e(2,((e,t)=>Vn(An(t),e))),Dn=e(2,((e,t)=>{if(t<=0)return En;if(t>=e.length)return e;switch(e.backing._tag){case"ISlice":return Mn({_tag:"ISlice",chunk:e.backing.chunk,length:t,offset:e.backing.offset});case"IConcat":return t>e.left.length?Mn({_tag:"IConcat",left:e.left,right:Dn(e.right,t-e.left.length)}):Dn(e.left,t);default:return Mn({_tag:"ISlice",chunk:e,offset:0,length:t})}})),zn=e(2,((e,t)=>{if(t<=0)return e;if(t>=e.length)return En;switch(e.backing._tag){case"ISlice":return Mn({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":return t>e.left.length?zn(e.right,t-e.left.length):Mn({_tag:"IConcat",left:zn(e.left,t),right:e.right});default:return Mn({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}})),Vn=e(2,((e,t)=>{if("IEmpty"===e.backing._tag)return t;if("IEmpty"===t.backing._tag)return e;const r=t.depth-e.depth;if(Math.abs(r)<=1)return Mn({_tag:"IConcat",left:e,right:t});if(r<-1){if(e.left.depth>=e.right.depth){const r=Vn(e.right,t);return Mn({_tag:"IConcat",left:e.left,right:r})}{const r=Vn(e.right.right,t);if(r.depth===e.depth-3){const t=Mn({_tag:"IConcat",left:e.right.left,right:r});return Mn({_tag:"IConcat",left:e.left,right:t})}{const t=Mn({_tag:"IConcat",left:e.left,right:e.right.left});return Mn({_tag:"IConcat",left:t,right:r})}}}if(t.right.depth>=t.left.depth){const r=Vn(e,t.left);return Mn({_tag:"IConcat",left:r,right:t.right})}{const r=Vn(e,t.left.left);if(r.depth===t.depth-3){const e=Mn({_tag:"IConcat",left:r,right:t.left.right});return Mn({_tag:"IConcat",left:e,right:t.right})}{const e=Mn({_tag:"IConcat",left:t.left.right,right:t.right});return Mn({_tag:"IConcat",left:r,right:e})}}})),Gn=e=>0===e.length,Hn=e=>e.length>0,Wn=Bn(0),Yn=e=>$n(e,0),Qn=Yn,Xn=e(2,((e,t)=>"ISingleton"===e.backing._tag?An(t(e.backing.a,0)):qn(a(Kn(e),Xt(((e,r)=>t(e,r))))))),Zn=e(2,((e,t)=>qn(Ht(Kn(e),t)))),es=e(2,((e,t)=>[Dn(e,t),zn(e,t)])),ts=e(2,((e,t)=>{let r=0;for(const n of Kn(e)){if(t(n))break;r++}return es(e,r)})),rs=e=>zn(e,1),ns=e=>qn(nr(Kn(e))),ss=Symbol.for("effect/Context/Tag"),is=Symbol.for("effect/STM"),as={...qe,_tag:"Tag",_op:"Tag",[is]:Be,[ss]:{_Service:e=>e,_Identifier:e=>e},toString(){return W(this.toJSON())},toJSON(){return{_id:"Tag",identifier:this.identifier,stack:this.stack}},[G](){return this.toJSON()},of:e=>e,context(e){return gs(this,e)}},os=l("effect/Context/Tag/tagRegistry",(()=>new Map)),cs=Symbol.for("effect/Context"),us={[cs]:{_Services:e=>e},[q](e){if(fs(e)&&this.unsafeMap.size===e.unsafeMap.size){for(const t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!$(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[M](){return L(this.unsafeMap.size)},pipe(){return Y(this,arguments)},toString(){return W(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(H)}},[G](){return this.toJSON()}},ls=e=>{const t=Object.create(us);return t.unsafeMap=e,t},fs=e=>w(e,cs),hs=ls(new Map),gs=(e,t)=>ls(new Map([[e,t]])),ps=e(3,((e,t,r)=>{const n=new Map(e.unsafeMap);return n.set(t,r),ls(n)})),ms=e(2,((e,t)=>{if(!e.unsafeMap.has(t))throw(e=>{const t=new Error("Service not found"+(e.identifier?`: ${String(e.identifier)}`:""));if(e.stack){const r=e.stack.split("\n");if(r.length>2){const e=r[2].match(/at (.*)/);e&&(t.message=t.message+` (defined at ${e[1]})`)}}if(t.stack){const e=t.stack.split("\n");e.splice(1,3),t.stack=e.join("\n")}return t})(t);return e.unsafeMap.get(t)})),ds=e=>{if(e&&os.has(e))return os.get(e);const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=t;const n=Object.create(as);return Object.defineProperty(n,"stack",{get:()=>r.stack}),e&&(n.identifier=e,os.set(e,n)),n},ys=()=>hs,bs=gs,_s=ps,Ss=ms,ws=ms,vs=e(2,((e,t)=>e.unsafeMap.has(t)?Xe(e.unsafeMap.get(t)):Qe)),ks=e(2,((e,t)=>{const r=new Map(e.unsafeMap);for(const[e,n]of t.unsafeMap)r.set(e,n);return ls(r)})),Os=Math.pow(2,5),Is=Os-1,Ns=Os/2,xs=Os/4;function Ts(e,t){return t>>>e&Is}function Fs(e){return 1<<e}function Ms(e,t){return r=e&t-1,r=(r=(858993459&(r-=r>>1&1431655765))+(r>>2&858993459))+(r>>4)&252645135,127&(r+=r>>8)+(r>>16);var r}class Rs{value;previous;constructor(e,t){this.value=e,this.previous=t}}function Es(e,t,r,n){let s=n;if(!e){const e=n.length;s=new Array(e);for(let t=0;t<e;++t)s[t]=n[t]}return s[t]=r,s}function Cs(e,t,r){const n=r.length-1;let s=0,i=0,a=r;if(e)s=i=t;else for(a=new Array(n);s<t;)a[i++]=r[s++];for(++s;s<=n;)a[i++]=r[s++];return e&&(a.length=n),a}class As{_tag="EmptyNode";modify(e,t,r,n,s,i){const a=r(ft());return pt(a)?new As:(++i.value,new Ks(e,n,s,a))}}function js(e){return v(e,"EmptyNode")}function Ls(e,t){return!js(e)&&t===e.edit}class Ks{edit;hash;key;value;_tag="LeafNode";constructor(e,t,r,n){this.edit=e,this.hash=t,this.key=r,this.value=n}modify(e,t,r,n,s,i){if($(s,this.key)){const t=r(this.value);return t===this.value?this:pt(t)?(--i.value,new As):Ls(this,e)?(this.value=t,this):new Ks(e,n,s,t)}const a=r(ft());return pt(a)?this:(++i.value,Js(e,t,this.hash,this,n,new Ks(e,n,s,a)))}}class Ps{edit;hash;children;_tag="CollisionNode";constructor(e,t,r){this.edit=e,this.hash=t,this.children=r}modify(e,t,r,n,s,i){if(n===this.hash){const t=Ls(this,e),n=this.updateCollisionList(t,e,this.hash,this.children,r,s,i);return n===this.children?this:n.length>1?new Ps(e,this.hash,n):n[0]}const a=r(ft());return pt(a)?this:(++i.value,Js(e,t,this.hash,this,n,new Ks(e,n,s,a)))}updateCollisionList(e,t,r,n,s,i,a){const o=n.length;for(let c=0;c<o;++c){const o=n[c];if("key"in o&&$(i,o.key)){const u=o.value,l=s(u);return l===u?n:pt(l)?(--a.value,Cs(e,c,n)):Es(e,c,new Ks(t,r,i,l),n)}}const c=s(ft());return pt(c)?n:(++a.value,Es(e,o,new Ks(t,r,i,c),n))}}class Bs{edit;mask;children;_tag="IndexedNode";constructor(e,t,r){this.edit=e,this.mask=t,this.children=r}modify(e,t,r,n,s,i){const a=this.mask,o=this.children,c=Ts(t,n),u=Fs(c),l=Ms(a,u),f=a&u,h=Ls(this,e);if(!f){const f=(new As).modify(e,t+5,r,n,s,i);return f?o.length>=Ns?function(e,t,r,n,s){const i=[];let a=n,o=0;for(let e=0;a;++e)1&a&&(i[e]=s[o++]),a>>>=1;return i[t]=r,new qs(e,o+1,i)}(e,c,f,a,o):new Bs(e,a|u,function(e,t,r,n){const s=n.length;if(e){let e=s;for(;e>=t;)n[e--]=n[e];return n[t]=r,n}let i=0,a=0;const o=new Array(s+1);for(;i<t;)o[a++]=n[i++];for(o[t]=r;i<s;)o[++a]=n[i++];return o}(h,l,f,o)):this}const g=o[l],p=g.modify(e,t+5,r,n,s,i);if(g===p)return this;let m,d=a;if(js(p)){if(d&=~u,!d)return new As;if(o.length<=2&&(js(y=o[1^l])||"LeafNode"===y._tag||"CollisionNode"===y._tag))return o[1^l];m=Cs(h,l,o)}else m=Es(h,l,p,o);var y;return h?(this.mask=d,this.children=m,this):new Bs(e,d,m)}}class qs{edit;size;children;_tag="ArrayNode";constructor(e,t,r){this.edit=e,this.size=t,this.children=r}modify(e,t,r,n,s,i){let a=this.size;const o=this.children,c=Ts(t,n),u=o[c],l=(u||new As).modify(e,t+5,r,n,s,i);if(u===l)return this;const f=Ls(this,e);let h;if(js(u)&&!js(l))++a,h=Es(f,c,l,o);else if(!js(u)&&js(l)){if(--a,a<=xs)return function(e,t,r,n){const s=new Array(t-1);let i=0,a=0;for(let e=0,t=n.length;e<t;++e)if(e!==r){const t=n[e];t&&!js(t)&&(s[i++]=t,a|=1<<e)}return new Bs(e,a,s)}(e,a,c,o);h=Es(f,c,new As,o)}else h=Es(f,c,l,o);return f?(this.size=a,this.children=h,this):new qs(e,a,h)}}function $s(e,t,r,n,s,i){if(r===s)return new Ps(e,r,[i,n]);const a=Ts(t,r),o=Ts(t,s);if(a===o)return t=>new Bs(e,Fs(a)|Fs(o),[t]);{const t=a<o?[n,i]:[i,n];return new Bs(e,Fs(a)|Fs(o),t)}}function Js(e,t,r,n,s,i){let a,o=t;for(;;){const t=$s(e,o,r,n,s,i);if("function"!=typeof t){let e=t;for(;null!=a;)e=a.value(e),a=a.previous;return e}a=new Rs(t,a),o+=5}}const Us="effect/HashMap",Ds=Symbol.for(Us),zs={[Ds]:Ds,[Symbol.iterator](){return new Gs(this,((e,t)=>[e,t]))},[M](){let e=R(Us);for(const t of this)e^=a(R(t[0]),C(R(t[1])));return e},[q](e){if(ei(e)){if(e._size!==this._size)return!1;for(const t of this){const r=a(e,ri(t[0],R(t[0])));if(pt(r))return!1;if(!$(t[1],r.value))return!1}return!0}return!1},toString(){return W(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(H)}},[G](){return this.toJSON()},pipe(){return Y(this,arguments)}},Vs=(e,t,r,n)=>{const s=Object.create(zs);return s._editable=e,s._edit=t,s._root=r,s._size=n,s};class Gs{map;f;v;constructor(e,t){this.map=e,this.f=t,this.v=Ws(this.map._root,this.f,void 0)}next(){if(pt(this.v))return{done:!0,value:void 0};const e=this.v.value;return this.v=Hs(e.cont),{done:!1,value:e.value}}[Symbol.iterator](){return new Gs(this.map,this.f)}}const Hs=e=>e?Ys(e[0],e[1],e[2],e[3],e[4]):ft(),Ws=(e,t,r=void 0)=>{switch(e._tag){case"LeafNode":return mt(e.value)?ht({value:t(e.key,e.value.value),cont:r}):Hs(r);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const n=e.children;return Ys(n.length,n,0,t,r)}default:return Hs(r)}},Ys=(e,t,r,n,s)=>{for(;r<e;){const i=t[r++];if(i&&!js(i))return Ws(i,n,[e,t,r,n,s])}return Hs(s)},Qs=Vs(!1,0,new As,0),Xs=()=>Qs,Zs=e=>{const t=ci(Xs());for(const r of e)si(t,r[0],r[1]);return ui(t)},ei=e=>w(e,Ds),ti=e(2,((e,t)=>ri(e,t,R(t)))),ri=e(3,((e,t,r)=>{let n=e._root,s=0;for(;;)switch(n._tag){case"LeafNode":return $(t,n.key)?n.value:ft();case"CollisionNode":if(r===n.hash){const e=n.children;for(let r=0,n=e.length;r<n;++r){const n=e[r];if("key"in n&&$(t,n.key))return n.value}}return ft();case"IndexedNode":{const e=Fs(Ts(s,r));if(n.mask&e){n=n.children[Ms(n.mask,e)],s+=5;break}return ft()}case"ArrayNode":if(n=n.children[Ts(s,r)],n){s+=5;break}return ft();default:return ft()}})),ni=e(2,((e,t)=>mt(ri(e,t,R(t))))),si=e(3,((e,t,r)=>li(e,t,(()=>ht(r))))),ii=e(3,((e,t,r)=>e._editable?(e._root=t,e._size=r,e):t===e._root?e:Vs(e._editable,e._edit,t,r))),ai=e=>new Gs(e,(e=>e)),oi=e=>e._size,ci=e=>Vs(!0,e._edit+1,e._root,e._size),ui=e=>(e._editable=!1,e),li=e(3,((e,t,r)=>fi(e,t,R(t),r))),fi=e(4,((e,t,r,n)=>{const s={value:e._size},i=e._root.modify(e._editable?e._edit:NaN,0,n,r,t,s);return a(e,ii(i,s.value))})),hi=e(2,((e,t)=>li(e,t,ft))),gi=e(2,((e,t)=>mi(e,Xs(),((e,r,n)=>si(e,n,t(r,n)))))),pi=e(2,((e,t)=>mi(e,void 0,((e,r,n)=>t(r,n))))),mi=e(3,((e,t,r)=>{const n=e._root;if("LeafNode"===n._tag)return mt(n.value)?r(t,n.value.value,n.key):t;if("EmptyNode"===n._tag)return t;const s=[n.children];let i;for(;i=s.pop();)for(let e=0,n=i.length;e<n;){const n=i[e++];n&&!js(n)&&("LeafNode"===n._tag?mt(n.value)&&(t=r(t,n.value.value,n.key)):s.push(n.children))}return t})),di="effect/HashSet",yi=Symbol.for(di),bi={[yi]:yi,[Symbol.iterator](){return ai(this._keyMap)},[M](){return C(R(this._keyMap))(R(di))},[q](e){return!!Si(e)&&oi(this._keyMap)===oi(e._keyMap)&&$(this._keyMap,e._keyMap)},toString(){return W(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(H)}},[G](){return this.toJSON()},pipe(){return Y(this,arguments)}},_i=e=>{const t=Object.create(bi);return t._keyMap=e,t},Si=e=>w(e,yi),wi=_i(Xs()),vi=()=>wi,ki=e(2,((e,t)=>ni(e._keyMap,t))),Oi=e=>_i(ci(e._keyMap)),Ii=e=>(e._keyMap._editable=!1,e),Ni=e(2,((e,t)=>{const r=Oi(e);return t(r),Ii(r)})),xi=e(2,((e,t)=>e._keyMap._editable?(si(t,!0)(e._keyMap),e):_i(si(t,!0)(e._keyMap)))),Ti=e(2,((e,t)=>e._keyMap._editable?(hi(t)(e._keyMap),e):_i(hi(t)(e._keyMap)))),Fi=e(2,((e,t)=>Ni(e,(e=>{for(const r of t)Ti(e,r)})))),Mi=e(2,((e,t)=>Ni(vi(),(r=>{Ri(e,(e=>xi(r,e)));for(const e of t)xi(r,e)})))),Ri=e(2,((e,t)=>pi(e._keyMap,((e,r)=>t(r))))),Ei=Si,Ci=vi,Ai=e=>{const t=Oi(vi());for(const r of e)xi(t,r);return Ii(t)},ji=(...e)=>{const t=Oi(vi());for(const r of e)xi(t,r);return Ii(t)},Li=ki,Ki=e=>oi(e._keyMap),Pi=xi,Bi=Ti,qi=Fi,$i=Mi,Ji=e(3,((e,t,r)=>mi(e._keyMap,t,((e,t,n)=>r(e,n))))),Ui=Symbol.for("effect/MutableRef"),Di={[Ui]:Ui,toString(){return W(this.toJSON())},toJSON(){return{_id:"MutableRef",current:H(this.current)}},[G](){return this.toJSON()},pipe(){return Y(this,arguments)}},zi=e=>{const t=Object.create(Di);return t.current=e,t},Vi=e=>e.current,Gi=e(2,((e,t)=>(e.current=t,e))),Hi=e(2,((e,t)=>(e.current=t,e.current))),Wi=e(2,((e,t)=>Gi(e,t(Vi(e))))),Yi=e(2,((e,t)=>Hi(e,t(Vi(e))))),Qi="effect/FiberId",Xi=Symbol.for(Qi),Zi="None",ea="Runtime";class ta{[Xi]=Xi;_tag=Zi;[M](){return a(R(Qi),C(R(this._tag)))}[q](e){return sa(e)&&e._tag===Zi}toString(){return W(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[G](){return this.toJSON()}}class ra{id;startTimeMillis;[Xi]=Xi;_tag=ea;constructor(e,t){this.id=e,this.startTimeMillis=t}[M](){return a(R(Qi),C(R(this._tag)),C(R(this.id)),C(R(this.startTimeMillis)))}[q](e){return sa(e)&&e._tag===ea&&this.id===e.id&&this.startTimeMillis===e.startTimeMillis}toString(){return W(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[G](){return this.toJSON()}}const na=new ta,sa=e=>w(e,Xi),ia=e=>{switch(e._tag){case Zi:return Ci();case ea:return ji(e.id);case"Composite":return a(ia(e.left),$i(ia(e.right)))}},aa=l(Symbol.for("effect/Fiber/Id/_fiberCounter"),(()=>zi(0))),oa=e=>Array.from(ia(e)).map((e=>`#${e}`)).join(","),ca=na,ua=oa,la=Xs,fa=Zs,ha=ti,ga=si,pa=ai,ma=oi,da=gi,ya=mi,ba=Symbol.for("effect/List"),_a=e=>Array.from(e),Sa=(e=>{return V((t=e,z(((e,r)=>{if(e.length!==r.length)return!1;for(let n=0;n<e.length;n++)if(!t(e[n],r[n]))return!1;return!0}))),_a);var t})($),wa={[ba]:ba,_tag:"Cons",toString(){return W(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:_a(this).map(H)}},[G](){return this.toJSON()},[q](e){return Ia(e)&&this._tag===e._tag&&Sa(this,e)},[M](){return B(_a(this))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if("Nil"===t._tag)return e=!0,this.return();const r=t.head;return t=t.tail,{done:e,value:r}},return:t=>(e||(e=!0),{done:!0,value:t})}},pipe(){return Y(this,arguments)}},va=(e,t)=>{const r=Object.create(wa);return r.head=e,r.tail=t,r},ka={[ba]:ba,_tag:"Nil",toString(){return W(this.toJSON())},toJSON:()=>({_id:"List",_tag:"Nil"}),[G](){return this.toJSON()},[M](){return B(_a(this))},[q](e){return Ia(e)&&this._tag===e._tag},[Symbol.iterator]:()=>({next:()=>({done:!0,value:void 0})}),pipe(){return Y(this,arguments)}},Oa=Object.create(ka),Ia=e=>w(e,ba),Na=e=>"Nil"===e._tag,xa=e=>"Cons"===e._tag,Ta=(e,t)=>va(e,t),Fa=()=>Oa,Ma=e=>va(e,Oa),Ra=e(2,((e,t)=>Ca(t,e))),Ea=e(2,((e,t)=>Ta(t,e))),Ca=e(2,((e,t)=>{if(Na(e))return t;if(Na(t))return e;{const r=va(t.head,e);let n=r,s=t.tail;for(;!Na(s);){const t=va(s.head,e);n.tail=t,n=t,s=s.tail}return r}})),Aa=e(3,((e,t,r)=>{let n=t,s=e;for(;!Na(s);)n=r(n,s.head),s=s.tail;return n})),ja=e=>{let t=Fa(),r=e;for(;!Na(r);)t=Ea(t,r.head),r=r.tail;return t},La=(Array.prototype,function(){function e(e){e&&Object.assign(this,e)}return e.prototype=$e,e}());La.prototype;const Ka=Symbol.for("effect/DifferContextPatch");function Pa(e){return e}const Ba={...La.prototype,[Ka]:{_Value:Pa,_Patch:Pa}},qa=Object.assign(Object.create(Ba),{_tag:"Empty"}),$a=Object.create(qa),Ja=()=>$a,Ua=Object.assign(Object.create(Ba),{_tag:"AndThen"}),Da=Object.assign(Object.create(Ba),{_tag:"AddService"}),za=(e,t)=>{const r=Object.create(Da);return r.tag=e,r.service=t,r},Va=Object.assign(Object.create(Ba),{_tag:"RemoveService"}),Ga=e=>{const t=Object.create(Va);return t.tag=e,t},Ha=Object.assign(Object.create(Ba),{_tag:"UpdateService"}),Wa=(e,t)=>{const r=Object.create(Ha);return r.tag=e,r.update=t,r},Ya=e(2,((e,t)=>((e,t)=>{const r=Object.create(Ua);return r.first=e,r.second=t,r})(e,t))),Qa=e(2,((e,t)=>{let r=!1,n=An(e);const s=new Map(t.unsafeMap);for(;Hn(n);){const e=Qn(n),t=rs(n);switch(e._tag){case"Empty":n=t;break;case"AddService":s.set(e.tag,e.service),n=t;break;case"AndThen":n=Un(Un(t,e.second),e.first);break;case"RemoveService":s.delete(e.tag),n=t;break;case"UpdateService":s.set(e.tag,e.update(s.get(e.tag))),r=!0,n=t}}if(!r)return ls(s);const i=new Map;for(const[e]of t.unsafeMap)s.has(e)&&(i.set(e,s.get(e)),s.delete(e));for(const[e,t]of s)i.set(e,t);return ls(i)}));La.prototype;const Xa=Symbol.for("effect/DifferHashSetPatch");function Za(e){return e}const eo={...La.prototype,[Xa]:{_Value:Za,_Key:Za,_Patch:Za}},to=Object.assign(Object.create(eo),{_tag:"Empty"}),ro=Object.create(to),no=()=>ro,so=Object.assign(Object.create(eo),{_tag:"AndThen"}),io=Object.assign(Object.create(eo),{_tag:"Add"}),ao=e=>{const t=Object.create(io);return t.value=e,t},oo=Object.assign(Object.create(eo),{_tag:"Remove"}),co=e(2,((e,t)=>((e,t)=>{const r=Object.create(so);return r.first=e,r.second=t,r})(e,t))),uo=e(2,((e,t)=>{let r=t,n=An(e);for(;Hn(n);){const e=Qn(n),t=rs(n);switch(e._tag){case"Empty":n=t;break;case"AndThen":n=Un(e.first)(Un(e.second)(t));break;case"Add":r=Pi(e.value)(r),n=t;break;case"Remove":r=Bi(e.value)(r),n=t}}return r}));La.prototype;const lo={[Symbol.for("effect/Differ")]:{_P:t,_V:t}},fo=e=>{const t=Object.create(lo);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},ho=()=>fo({empty:no(),combine:(e,t)=>co(t)(e),diff:(e,t)=>((e,t)=>{const[r,n]=Ji([e,no()],(([e,t],r)=>Li(r)(e)?[Bi(r)(e),t]:[e,co(ao(r))(t)]))(t);return Ji(n,((e,t)=>co((e=>{const t=Object.create(oo);return t.value=e,t})(t))(e)))(r)})(e,t),patch:(e,t)=>uo(t)(e)}),go=e=>fo({empty:t,combine:(e,r)=>e===t?r:r===t?e:t=>r(e(t)),diff:(e,n)=>$(e,n)?t:r(n),patch:(t,r)=>e(r,t(r))}),po=255,mo=e=>e&po,yo=e=>e>>8&po,bo=(e,t)=>(e&po)+((t&e&po)<<8),_o=bo(0,0),So=e(2,((e,t)=>bo(mo(e)&~t,yo(e)))),wo=e(2,((e,t)=>e|t)),vo=e(2,((e,t)=>e|t)),ko=e=>Oo(e)&&!To(e),Oo=e=>Io(e,1),Io=e(2,((e,t)=>0!=(e&t))),No=((...e)=>e.reduce(((e,t)=>e|t),0))(0),xo=e=>Io(e,4),To=e=>Io(e,16),Fo=e(2,((e,t)=>bo(e^t,t))),Mo=e(2,((e,t)=>e&(~mo(t)>>>0&po|yo(t))|mo(t)&yo(t))),Ro=fo({empty:_o,diff:(e,t)=>Fo(e,t),combine:(e,t)=>wo(t)(e),patch:(e,t)=>Mo(t,e)}),Eo=e=>bo(e,0),Co=So,Ao="Die",jo="Empty",Lo="Fail",Ko="Interrupt",Po="Parallel",Bo="Sequential",qo="effect/Cause",$o=Symbol.for(qo),Jo={[$o]:{_E:e=>e},[M](){return a(R(qo),C(R(ec(this))))},[q](e){return Wo(e)&&Zo(this,e)},pipe(){return Y(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:H(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:H(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:H(this.left),right:H(this.right)}}},toString(){return lc(this)},[G](){return this.toJSON()}},Uo=(()=>{const e=Object.create(Jo);return e._tag=jo,e})(),Do=e=>{const t=Object.create(Jo);return t._tag=Lo,t.error=e,t},zo=e=>{const t=Object.create(Jo);return t._tag=Ao,t.defect=e,t},Vo=e=>{const t=Object.create(Jo);return t._tag=Ko,t.fiberId=e,t},Go=(e,t)=>{const r=Object.create(Jo);return r._tag=Po,r.left=e,r.right=t,r},Ho=(e,t)=>{const r=Object.create(Jo);return r._tag=Bo,r.left=e,r.right=t,r},Wo=e=>w(e,$o),Yo=e=>uc(void 0,sc)(e),Qo=e=>{const t=(e=>rc(e,(e=>e._tag===Lo?ht(e.error):ft())))(e);switch(t._tag){case"None":return at(e);case"Some":return ot(t.value)}},Xo=e=>oc(e,{onEmpty:Uo,onFail:()=>Uo,onDie:e=>zo(e),onInterrupt:e=>Vo(e),onSequential:Ho,onParallel:Go}),Zo=(e,t)=>{let r=An(e),n=An(t);for(;Hn(r)&&Hn(n);){const[e,t]=a(Qn(r),cc([Ci(),Cn()],(([e,t],r)=>{const[n,s]=nc(r);return ht([a(e,$i(n)),a(t,Vn(s))])}))),[s,i]=a(Qn(n),cc([Ci(),Cn()],(([e,t],r)=>{const[n,s]=nc(r);return ht([a(e,$i(n)),a(t,Vn(s))])})));if(!$(e,s))return!1;r=t,n=i}return!0},ec=e=>tc(An(e),Cn()),tc=(e,t)=>{for(;;){const[r,n]=a(e,tr([Ci(),Cn()],(([e,t],r)=>{const[n,s]=nc(r);return[a(e,$i(n)),a(t,Vn(s))]}))),s=Ki(r)>0?a(t,Un(r)):t;if(Gn(n))return Pn(s);e=n,t=s}throw new Error("BUG: Cause.flattenCauseLoop - please report an issue at https://github.com/Effect-TS/effect/issues")},rc=e(2,((e,t)=>{const r=[e];for(;r.length>0;){const e=r.pop(),n=t(e);switch(n._tag){case"None":switch(e._tag){case Bo:case Po:r.push(e.right),r.push(e.left)}break;case"Some":return n}}return ft()})),nc=e=>{let t=e;const r=[];let n=Ci(),s=Cn();for(;void 0!==t;)switch(t._tag){case jo:if(0===r.length)return[n,s];t=r.pop();break;case Lo:if(n=Pi(n,t.error),0===r.length)return[n,s];t=r.pop();break;case Ao:if(n=Pi(n,t.defect),0===r.length)return[n,s];t=r.pop();break;case Ko:if(n=Pi(n,t.fiberId),0===r.length)return[n,s];t=r.pop();break;case Bo:switch(t.left._tag){case jo:t=t.right;break;case Bo:t=Ho(t.left.left,Ho(t.left.right,t.right));break;case Po:t=Go(Ho(t.left.left,t.right),Ho(t.left.right,t.right));break;default:s=Un(s,t.right),t=t.left}break;case Po:r.push(t.right),t=t.left}throw new Error("BUG: Cause.evaluateCauseLoop - please report an issue at https://github.com/Effect-TS/effect/issues")},sc={emptyCase:n,failCase:s,dieCase:s,interruptCase:n,sequentialCase:(e,t,r)=>t&&r,parallelCase:(e,t,r)=>t&&r},ic="SequentialCase",ac="ParallelCase",oc=e(2,((e,{onDie:t,onEmpty:r,onFail:n,onInterrupt:s,onParallel:i,onSequential:a})=>uc(e,void 0,{emptyCase:()=>r,failCase:(e,t)=>n(t),dieCase:(e,r)=>t(r),interruptCase:(e,t)=>s(t),sequentialCase:(e,t,r)=>a(t,r),parallelCase:(e,t,r)=>i(t,r)}))),cc=e(3,((e,t,r)=>{let n=t,s=e;const i=[];for(;void 0!==s;){const e=r(n,s);switch(n=mt(e)?e.value:n,s._tag){case Bo:case Po:i.push(s.right),s=s.left;break;default:s=void 0}void 0===s&&i.length>0&&(s=i.pop())}return n})),uc=e(3,((e,t,r)=>{const n=[e],s=[];for(;n.length>0;){const e=n.pop();switch(e._tag){case jo:s.push(at(r.emptyCase(t)));break;case Lo:s.push(at(r.failCase(t,e.error)));break;case Ao:s.push(at(r.dieCase(t,e.defect)));break;case Ko:s.push(at(r.interruptCase(t,e.fiberId)));break;case Bo:n.push(e.right),n.push(e.left),s.push(ot({_tag:ic}));break;case Po:n.push(e.right),n.push(e.left),s.push(ot({_tag:ac}))}}const i=[];for(;s.length>0;){const e=s.pop();switch(e._tag){case"Left":switch(e.left._tag){case ic:{const e=i.pop(),n=i.pop(),s=r.sequentialCase(t,e,n);i.push(s);break}case ac:{const e=i.pop(),n=i.pop(),s=r.parallelCase(t,e,n);i.push(s);break}}break;case"Right":i.push(e.right)}}if(0===i.length)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return i.pop()})),lc=e=>{if(Yo(e))return"All fibers interrupted without errors.";return mc(e).map((e=>{let t=e.message;if(e.stack&&(t+=`\r\n${(e=>{const t=e.split("\n"),r=[];for(let e=0;e<t.length;e++){if(t[e].includes("EffectPrimitive")||t[e].includes("Generator.next")||t[e].includes("FiberRuntime"))return r.join("\n");r.push(t[e])}return r.join("\n")})(e.stack)}`),e.span){let r=e.span,n=0;for(;r&&"Span"===r._tag&&n<10;)t+=`\r\n    at ${r.name}`,r=St(r.parent),n++}return t})).join("\r\n")};class fc{message;stack;span;constructor(e,t,r){this.message=e,this.stack=t,this.span=r}toJSON(){const e={message:this.message};return this.stack&&(e.stack=this.stack),this.span&&(e.span=this.span),e}}const hc=e=>"string"==typeof e?`Error: ${e}`:w(e,"toString")&&d(e.toString)&&e.toString!==Object.prototype.toString?e.toString():`Error: ${JSON.stringify(e)}`,gc=Symbol.for("effect/SpanAnnotation"),pc=e=>{const t=w(e,gc)&&e[gc];return e instanceof Error?new fc(hc(e),e.stack?.split("\n").filter((e=>e.match(/at (.*)/))).join("\n"),t):new fc(hc(e),void 0,t)},mc=e=>uc(e,void 0,{emptyCase:()=>[],dieCase:(e,t)=>[pc(t)],failCase:(e,t)=>[pc(t)],interruptCase:()=>[],parallelCase:(e,t,r)=>[...t,...r],sequentialCase:(e,t,r)=>[...t,...r]}),dc="Pending",yc="Done",bc=Symbol.for("effect/Deferred"),_c={_E:e=>e,_A:e=>e},Sc=e=>({_tag:dc,joiners:e}),wc=Symbol.for("effect/Tracer"),vc=e=>({[wc]:wc,...e}),kc=ds(Symbol.for("effect/Tracer")),Oc=ds(Symbol.for("effect/ParentSpan")),Ic=l("effect/Tracer/SpanId.ids",(()=>zi(0)));class Nc{name;parent;context;links;startTime;_tag="Span";spanId;traceId="native";sampled=!0;status;attributes;events=[];constructor(e,t,r,n,s){var i;this.name=e,this.parent=t,this.context=r,this.links=n,this.startTime=s,this.status={_tag:"Started",startTime:s},this.attributes=new Map,this.spanId=`span${i=Ic,Yi(i,(e=>e+1))}`}end=(e,t)=>{this.status={_tag:"Ended",endTime:e,exit:t,startTime:this.status.startTime}};attribute=(e,t)=>{this.attributes.set(e,t)};event=(e,t,r)=>{this.events.push([e,t,r??{}])}}const xc=vc({span:(e,t,r,n,s)=>new Nc(e,t,r,n,s),context:e=>e()}),Tc=Symbol.for("effect/EffectError"),Fc=(e,t)=>{const r=new Ec("Blocked");return r.i0=e,r.i1=t,r},Mc=Symbol.for("effect/Effect");class Rc{patch;op;_op=Ae;constructor(e,t){this.patch=e,this.op=t}}class Ec{_op;i0=void 0;i1=void 0;i2=void 0;trace=void 0;[Mc]=Be;constructor(e){this._op=e}[q](e){return this===e}[M](){return E(this)}pipe(){return Y(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,i0:H(this.i0),i1:H(this.i1),i2:H(this.i2)}}toString(){return W(this.toJSON())}[G](){return this.toJSON()}}class Cc{_op;i0=void 0;i1=void 0;i2=void 0;trace=void 0;[Mc]=Be;constructor(e){this._op=e,this._tag=e}[q](e){return this===e}[M](){return E(this)}get cause(){return this.i0}pipe(){return Y(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return W(this.toJSON())}[G](){return this.toJSON()}}class Ac{_op;i0=void 0;i1=void 0;i2=void 0;trace=void 0;[Mc]=Be;constructor(e){this._op=e,this._tag=e}[q](e){return this===e}[M](){return E(this)}get value(){return this.i0}pipe(){return Y(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:H(this.value)}}toString(){return W(this.toJSON())}[G](){return this.toJSON()}}const jc=e=>w(e,Mc),Lc=e=>{const t=new Ec(Ee);return t.i0=e,t},Kc=e(3,((e,t,r)=>yu((n=>Xc(e,(e=>Xc(Vc(gu((()=>n(t(e))))),(t=>gu((()=>r(e,t))).pipe(ru({onFailure:e=>{switch(t._tag){case Oe:return Wc(Go(t.i0,e));case Te:return Wc(e)}},onSuccess:()=>t})))))))))),Pc=e(2,((e,t)=>Xc(e,(()=>hu(t))))),Bc=e=>Pc(e,void 0),qc=(e,t=ca)=>gu((()=>{let r,n;function s(e){r?r(e):void 0===n&&(n=e)}const i=new Ec(ve);let a,o;return i.i0=e=>{r=e,n&&e(n)},i.i1=t,1!==e.length?(o=new AbortController,a=e(s,o.signal)):a=e(s),a||o?fu(i,(e=>(o&&o.abort(),a??bu))):i})),$c=(e,t=ca)=>qc((t=>{const r=e(t);if(!ut(r))return r.left;t(r.right)}),t),Jc=e(2,((e,t)=>nu(e,{onFailure:t,onSuccess:hu}))),Uc=Symbol.for("effect/SpanAnnotation"),Dc=Symbol.for("effect/OriginalAnnotation"),zc=e=>nu(e,{onFailure:e=>hu(ot(e)),onSuccess:e=>hu(at(e))}),Vc=e=>tu(e,{onFailure:ll,onSuccess:gl}),Gc=e=>S(e)&&!(Uc in e)?Lc((t=>{return Wc(Do((r=e,n=Ol(t),mt(n)?new Proxy(r,{has:(e,t)=>t===Uc||t===Dc||t in e,get:(e,t)=>t===Uc?n.value:t===Dc?r:e[t]}):r)));var r,n})):Wc(Do(e)),Hc=e=>Xc(pu(e),Gc),Wc=e=>{const t=new Cc(Oe);return t.i0=e,t},Yc=e=>Xc(pu(e),Wc),Qc=Lc((e=>hu(e.id()))),Xc=e(2,((e,t)=>{const r=new Ec(Ne);return r.i0=e,r.i1=t,r})),Zc=e=>{const t=new Ec("OnStep");return t.i0=e,t},eu=e=>Xc(e,t),tu=e(2,((e,{onFailure:t,onSuccess:r})=>ru(e,{onFailure:e=>hu(t(e)),onSuccess:e=>hu(r(e))}))),ru=e(2,((e,{onFailure:t,onSuccess:r})=>{const n=new Ec(xe);return n.i0=e,n.i1=t,n.i2=r,n})),nu=e(2,((e,{onFailure:t,onSuccess:r})=>ru(e,{onFailure:e=>{const r=(e=>Pn(cc(e,Cn(),((e,t)=>t._tag===Lo?ht(a(e,Un(t.error))):ft()))))(e);return(e=>Pn(cc(e,Cn(),((e,t)=>t._tag===Ao?ht(a(e,Un(t.defect))):ft()))))(e).length>0?Wc((e=>oc(e,{onEmpty:Uo,onFail:e=>zo(e),onDie:e=>zo(e),onInterrupt:e=>Vo(e),onSequential:(e,t)=>Ho(e,t),onParallel:(e,t)=>Go(e,t)}))(e)):r.length>0?t(Yn(r)):Wc(e)},onSuccess:r}))),su=e(2,((e,t)=>gu((()=>{const r=jt(e),n=new Array(r.length);let s=0;return Pc(_u({while:()=>s<r.length,body:()=>t(r[s],s),step:e=>{n[s++]=e}}),n)})))),iu=e(2,((e,t)=>gu((()=>{const r=jt(e);let n=0;return _u({while:()=>n<r.length,body:()=>t(r[n],n),step:()=>{n++}})})))),au=e=>{const t=new Ec(Me);return t.i0=bo(r=1,r),t.i1=()=>e,t;var r},ou=e(2,((e,t)=>Xc(e,(e=>pu((()=>t(e))))))),cu=e(2,((e,{onFailure:t,onSuccess:r})=>nu(e,{onFailure:e=>Hc((()=>t(e))),onSuccess:e=>pu((()=>r(e)))}))),uu=e(2,((e,t)=>ru(e,{onFailure:e=>{const r=Qo(e);switch(r._tag){case"Left":return Hc((()=>t(r.left)));case"Right":return Wc(r.right)}},onSuccess:hu}))),lu=e(2,((e,t)=>yu((r=>ru(r(e),{onFailure:e=>{const r=ll(e);return ru(t(r),{onFailure:t=>ll(Ho(e,t)),onSuccess:()=>r})},onSuccess:e=>{const r=gl(e);return ku(t(r),r)}}))))),fu=e(2,((e,t)=>lu(e,hl({onFailure:e=>Yo(e)?Bc(t((e=>cc(e,Ci(),((e,t)=>t._tag===Ko?ht(a(e,Pi(t.fiberId))):ft())))(e))):bu,onSuccess:()=>bu})))),hu=e=>{const t=new Ac(Te);return t.i0=e,t},gu=e=>Xc(pu(e),t),pu=e=>{const t=new Ec(Fe);return t.i0=e,t},mu=e(2,((e,t)=>Xc(e,(e=>{const r="function"==typeof t?t(e):t;return jc(r)?Pc(r,e):w(n=r,"then")&&"catch"in n&&d(n.then)&&d(n.catch)?qc((t=>{r.then((r=>t(hu(e)))).catch((e=>t(Gc(new cl(e)))))})):hu(e);var n})))),du=e=>{const t=new Ec(Me);return t.i0=Eo(1),t.i1=()=>e,t},yu=e=>{const t=new Ec(Me);return t.i0=Eo(1),t.i1=t=>Oo(t)?e(au):e(du),t},bu=hu(void 0),_u=e=>{const t=new Ec(Re);return t.i0=e.while,t.i1=e.body,t.i2=e.step,t},Su=e=>{const t=new Ec(Ce);return void 0!==e?.priority?zu(t,e.priority):t},wu=e(2,((e,t)=>Xc(e,(e=>ou(t,(t=>[e,t])))))),vu=e(2,((e,t)=>Xc(e,(e=>Pc(t,e))))),ku=e(2,((e,t)=>Xc(e,(()=>t)))),Ou=e(2,((e,t)=>Xc(e.interruptAsFork(t),(()=>e.await)))),Iu=(Number.MIN_SAFE_INTEGER,{_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return Y(this,arguments)}}),Nu={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return Y(this,arguments)}},xu=(Number.MAX_SAFE_INTEGER,Symbol.for("effect/FiberRef")),Tu={_A:e=>e},Fu=e=>Eu(e,(e=>[e,e])),Mu=e(2,((e,t)=>Xc(Fu(e),t))),Ru=e(2,((e,t)=>Eu(e,(()=>[void 0,t])))),Eu=e(2,((e,t)=>Lc((r=>{const[n,s]=t(r.getFiberRef(e));return r.setFiberRef(e,s),hu(n)})))),Cu=e(3,((e,t,r)=>Kc(vu(Fu(t),Ru(t,r)),(()=>e),(e=>Ru(t,e))))),Au=(e,r)=>Ku(e,{differ:go(((e,t)=>t)),fork:r?.fork??t,join:r?.join}),ju=e=>{const t=ho();return Ku(e,{differ:t,fork:t.empty})},Lu=e=>{const t=fo({empty:Ja(),combine:(e,t)=>Ya(t)(e),diff:(e,t)=>((e,t)=>{const r=new Map(e.unsafeMap);let n=Ja();for(const[e,s]of t.unsafeMap.entries())if(r.has(e)){const t=r.get(e);r.delete(e),$(t,s)||(n=Ya(Wa(e,(()=>s)))(n))}else r.delete(e),n=Ya(za(e,s))(n);for(const[e]of r.entries())n=Ya(Ga(e))(n);return n})(e,t),patch:(e,t)=>Qa(t)(e)});return Ku(e,{differ:t,fork:t.empty})},Ku=(e,t)=>({[xu]:Tu,initial:e,diff:(e,r)=>t.differ.diff(e,r),combine:(e,r)=>t.differ.combine(e,r),patch:e=>r=>t.differ.patch(e,r),fork:t.fork,join:t.join??((e,t)=>t),pipe(){return Y(this,arguments)}}),Pu=e=>Ku(e,{differ:Ro,fork:Ro.empty}),Bu=l(Symbol.for("effect/FiberRef/currentContext"),(()=>Lu(ys()))),qu=l(Symbol.for("effect/FiberRef/currentSchedulingPriority"),(()=>Au(0))),$u=l(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),(()=>Au(2048))),Ju=l(Symbol.for("effect/FiberRef/currentLogAnnotation"),(()=>Au(la()))),Uu=l(Symbol.for("effect/FiberRef/currentLogLevel"),(()=>Au(Iu))),Du=l(Symbol.for("effect/FiberRef/currentLogSpan"),(()=>Au(Fa()))),zu=e(2,((e,t)=>Cu(e,qu,t))),Vu=l(Symbol.for("effect/FiberRef/currentConcurrency"),(()=>Au("unbounded"))),Gu=l(Symbol.for("effect/FiberRef/currentRequestBatching"),(()=>Au(!0))),Hu=l(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),(()=>Au(ht(Nu)))),Wu=l(Symbol.for("effect/FiberRef/currentMetricLabels"),(()=>ju(Ci()))),Yu=l(Symbol.for("effect/FiberRef/currentForkScopeOverride"),(()=>Au(ft(),{fork:()=>ft(),join:(e,t)=>e}))),Qu=l(Symbol.for("effect/FiberRef/currentInterruptedCause"),(()=>Au(Uo,{fork:()=>Uo,join:(e,t)=>e}))),Xu=Symbol.for("effect/Scope"),Zu=(e,t)=>e.fork(t),el=function(){class e extends globalThis.Error{commit(){return Gc(this)}toString(){return this.message?`${this.name}: ${this.message}`:this.name}toJSON(){return{...this}}[G](){const e=this.stack;return e?`${this.toString()}\n${e.split("\n").slice(1).join("\n")}`:this.toString()}}return Object.assign(e.prototype,Ue),e}(),tl=(e,t)=>{class r extends el{_tag=t}return Object.assign(r.prototype,e),r.prototype.name=t,r},rl=Symbol.for("effect/Cause/errors/RuntimeException"),nl=tl({[rl]:rl},"RuntimeException"),sl=Symbol.for("effect/Cause/errors/InterruptedException"),il=Symbol.for("effect/Cause/errors/NoSuchElement"),al=tl({[il]:il},"NoSuchElementException"),ol=Symbol.for("effect/Cause/errors/UnknownException"),cl=function(){class e extends el{error;_tag="UnknownException";constructor(e,t){super(t??(w(e,"message")&&f(e.message)?e.message:void 0)),this.error=e}}return Object.assign(e.prototype,{[ol]:ol,name:"UnknownException"}),e}(),ul=(e,t)=>dl(e,t?.parallel?Go:Ho),ll=e=>{const t=new Cc(Oe);return t.i0=e,t},fl=e(2,((e,t)=>{switch(e._tag){case Oe:return ll(e.i0);case Te:return gl(t(e.i0))}})),hl=e(2,((e,{onFailure:t,onSuccess:r})=>{switch(e._tag){case Oe:return t(e.i0);case Te:return r(e.i0)}})),gl=e=>{const t=new Ac(Te);return t.i0=e,t},pl=gl(void 0),ml=e(3,((e,t,{onFailure:r,onSuccess:n})=>{switch(e._tag){case Oe:switch(t._tag){case Te:return ll(e.i0);case Oe:return ll(r(e.i0,t.i0))}case Te:switch(t._tag){case Te:return gl(n(e.i0,t.i0));case Oe:return ll(t.i0)}}})),dl=(e,t)=>{const r=jn(e);return Hn(r)?a(rs(r),tr(a(Qn(r),fl(An)),((e,r)=>a(e,ml(r,{onSuccess:(e,t)=>a(e,Un(t)),onFailure:t})))),fl(Pn),fl((e=>Array.from(e))),ht):ft()},yl=e=>({[bc]:_c,state:zi(Sc([])),blockingOn:e,pipe(){return Y(this,arguments)}}),bl=(e,t)=>{const r=Vi(e.state);if(r._tag===dc){a(e.state,Gi((e=>({_tag:yc,effect:e}))(t)));for(let e=r.joiners.length-1;e>=0;e--)r.joiners[e](t)}},_l=(e,t)=>pu((()=>{const r=Vi(e.state);r._tag===dc&&a(e.state,Gi(Sc(r.joiners.filter((e=>e!==t)))))})),Sl=Fu(Bu),wl=e=>Xc(Sl,e),vl=e(2,((e,t)=>Cu(Bu,t)(e))),kl=e(2,((e,t)=>wl((r=>vl(e,t(r)))))),Ol=e=>{const t=e.getFiberRef(Bu).unsafeMap.get(Oc);return void 0!==t&&"Span"===t._tag?ht(t):ft()},Il="undefined"!=typeof process&&!!process?.isBun,Nl=Il?e=>clearInterval(e):e=>clearTimeout(e),xl=Il?(e,t)=>{const r=setInterval((()=>{e(),clearInterval(r)}),t);return r}:(e,t)=>setTimeout(e,t),Tl=Symbol.for("effect/Clock"),Fl=ds(Tl),Ml={unsafeSchedule(e,t){const r=de(t);if(r>2147483647)return s;let n=!1;const i=xl((()=>{n=!0,e()}),r);return()=>(Nl(i),!n)}},Rl=function(){const e=BigInt(1e6);if("undefined"==typeof performance)return()=>BigInt(Date.now())*e;const t="timeOrigin"in performance&&"number"==typeof performance.timeOrigin?BigInt(Math.round(1e6*performance.timeOrigin)):BigInt(Date.now())*e-BigInt(Math.round(1e6*performance.now()));return()=>t+BigInt(Math.round(1e6*performance.now()))}(),El=function(){const e="object"==typeof process&&"hrtime"in process&&"function"==typeof process.hrtime.bigint?process.hrtime:void 0;if(!e)return Rl;const t=Rl()-e.bigint();return()=>t+e.bigint()}();class Cl{[Tl]=Tl;unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return El()}currentTimeMillis=pu((()=>this.unsafeCurrentTimeMillis()));currentTimeNanos=pu((()=>this.unsafeCurrentTimeNanos()));scheduler(){return hu(Ml)}sleep(e){return $c((t=>{const r=Ml.unsafeSchedule((()=>t(bu)),e);return ot(Bc(pu(r)))}))}}const Al=()=>new Cl,jl="InvalidData",Ll="MissingData",Kl="SourceUnavailable",Pl="Unsupported",Bl=Symbol.for("effect/ConfigError"),ql={[Bl]:Bl},$l=(e,t)=>{const r=Object.create(ql);return r._tag="And",r.left=e,r.right=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),r},Jl=(e,t)=>{const r=Object.create(ql);return r._tag="Or",r.left=e,r.right=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),r},Ul=(e,t,r={pathDelim:"."})=>{const n=Object.create(ql);return n._tag=jl,n.path=e,n.message=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`(Invalid data at ${a(this.path,sr(r.pathDelim))}: "${this.message}")`}}),n},Dl=(e,t,r={pathDelim:"."})=>{const n=Object.create(ql);return n._tag=Ll,n.path=e,n.message=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`(Missing data at ${a(this.path,sr(r.pathDelim))}: "${this.message}")`}}),n},zl=(e,t,r,n={pathDelim:"."})=>{const s=Object.create(ql);return s._tag=Kl,s.path=e,s.message=t,s.cause=r,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${a(this.path,sr(n.pathDelim))}: "${this.message}")`}}),s},Vl=(e,t,r={pathDelim:"."})=>{const n=Object.create(ql);return n._tag=Pl,n.path=e,n.message=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${a(this.path,sr(r.pathDelim))}: "${this.message}")`}}),n},Gl=e(2,((e,t)=>{switch(e._tag){case"And":return $l(Gl(e.left,t),Gl(e.right,t));case"Or":return Jl(Gl(e.left,t),Gl(e.right,t));case jl:return Ul([...t,...e.path],e.message);case Ll:return Dl([...t,...e.path],e.message);case Kl:return zl([...t,...e.path],e.message,e.cause);case Pl:return Vl([...t,...e.path],e.message)}})),Hl={_tag:"Empty"},Wl=e(2,((e,t)=>{let r=Ma(t),n=e;for(;xa(r);){const e=r.head;switch(e._tag){case"Empty":r=r.tail;break;case"AndThen":r=Ta(e.first,Ta(e.second,r.tail));break;case"MapName":n=Xt(n,e.f),r=r.tail;break;case"Nested":n=Lt(n,e.name),r=r.tail;break;case"Unnested":if(!a(Dt(n),It(e.name)))return ot(Dl(n,`Expected ${e.name} to be in path in ConfigProvider#unnested`));n=Vt(n),r=r.tail}}return at(n)})),Yl=(e,t)=>[...e,...t],Ql=Symbol.for("effect/ConfigProvider"),Xl=ds(Ql),Zl=Symbol.for("effect/ConfigProviderFlat"),ef=e=>({[Ql]:Ql,pipe(){return Y(this,arguments)},...e}),tf=(e={})=>{const{pathDelim:t,seqDelim:r}=Object.assign({},{pathDelim:"_",seqDelim:","},e),n=()=>"undefined"!=typeof process&&"env"in process&&"object"==typeof process.env?process.env:{};return s={[Zl]:Zl,patch:(i={load:(e,s,i=!0)=>{const o=(e=>a(e,sr(t)))(e),c=n();return a(o in c?ht(c[o]):ft(),uu((()=>Dl(e,`Expected ${o} to exist in the process context`))),Xc((t=>sf(t,e,s,r,i))))},enumerateChildren:e=>pu((()=>{const r=n(),s=Object.keys(r),i=Array.from(s).map((e=>e.toUpperCase().split(t))).filter((t=>{for(let r=0;r<e.length;r++){const n=a(e,Ut(r)),s=t[r];if(void 0===s||n!==s)return!1}return!0})).flatMap((t=>t.slice(e.length,e.length+1)));return Ai(i)})),patch:Hl}).patch,load:(e,t,r=!0)=>i.load(e,t,r),enumerateChildren:i.enumerateChildren},ef({load:e=>Xc(rf(s,[],e,!1),(t=>dt(Dt(t),{onNone:()=>Gc(Dl([],`Expected a single value having structure: ${e}`)),onSome:hu}))),flattened:s});var s,i},rf=(e,t,r,n)=>{const s=r;switch(s._tag){case"Constant":return hu(Qt(s.value));case"Described":return gu((()=>rf(e,t,s.config,n)));case"Fail":return Gc(Dl(t,s.message));case"Fallback":return a(gu((()=>rf(e,t,s.first,n))),Jc((r=>s.condition(r)?a(rf(e,t,s.second,n),Jc((e=>Gc(Jl(r,e))))):Gc(r))));case"Lazy":return gu((()=>rf(e,t,s.config(),n)));case"MapOrFail":return gu((()=>a(rf(e,t,s.original,n),Xc(su((e=>a(s.mapOrFail(e),uu(Gl(((e,t)=>{let r=t;if("Nested"===r._tag){const t=e.slice();for(;"Nested"===r._tag;)t.push(r.name),r=r.config;return t}return e})(t,s.original))))))))));case"Nested":return gu((()=>rf(e,Yl(t,Qt(s.name)),s.config,n)));case"Primitive":return a(Wl(t,e.patch),Xc((t=>a(e.load(t,s,n),Xc((e=>{if(0===e.length){const e=a(qt(r=t)?ht((e=>e[e.length-1])(r)):ft(),yt((()=>"<n/a>")));return Gc(Dl([],`Expected ${s.description} with name ${e}`))}var r;return hu(e)}))))));case"Sequence":return a(Wl(t,e.patch),Xc((r=>a(e.enumerateChildren(r),Xc(cf),Xc((n=>0===n.length?gu((()=>ou(rf(e,r,s.config,!0),Qt))):a(su(n,(r=>rf(e,Kt(t,`[${r}]`),s.config,!0))),ou((e=>{const t=er(e);return 0===t.length?Qt([]):Qt(t)})))))))));case"HashMap":return gu((()=>a(Wl(t,e.patch),Xc((t=>a(e.enumerateChildren(t),Xc((r=>a(r,su((r=>rf(e,Yl(t,Qt(r)),s.valueConfig,n))),ou((e=>{if(0===e.length)return Qt(la());const t=e.map((e=>Array.from(e)));return a(af(t),Xt((e=>fa(Wt(jt(r),e)))))})))))))))));case"ZipWith":return gu((()=>a(rf(e,t,s.left,n),zc,Xc((r=>a(rf(e,t,s.right,n),zc,Xc((e=>{if(ct(r)&&ct(e))return Gc($l(r.left,e.left));if(ct(r)&&ut(e))return Gc(r.left);if(ut(r)&&ct(e))return Gc(e.left);if(ut(r)&&ut(e)){const n=a(t,sr(".")),i=nf(t,n),[o,c]=((e,t,r,n)=>{const s=rr(r.length,(t=>t>=n.length?ft():ht([e(t),t+1]))),i=rr(n.length,(e=>e>=r.length?ft():ht([t(e),e+1])));return[Yl(r,s),Yl(n,i)]})(i,i,a(r.right,Xt(at)),a(e.right,Xt(at)));return a(o,Wt(c),su((([e,t])=>a(wu(e,t),ou((([e,t])=>s.zip(e,t)))))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")}))))))))}},nf=(e,t)=>r=>ot(Dl(e,`The element at index ${r} in a sequence at path "${t}" was missing`)),sf=(e,t,r,n,s)=>s?a(((e,t)=>e.split(new RegExp(`\\s*${of(t)}\\s*`)))(e,n),su((e=>r.parse(e.trim()))),uu(Gl(t))):a(r.parse(e),cu({onFailure:Gl(t),onSuccess:Qt})),af=e=>Object.keys(e[0]).map((t=>e.map((e=>e[t])))),of=e=>e.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&"),cf=e=>a(su(e,lf),cu({onFailure:()=>[],onSuccess:Ht(ir)}),zc,ou(lt)),uf=/^(\[(\d+)\])$/,lf=e=>{const t=e.match(uf);if(null!==t){const e=t[2];return a(void 0!==e&&e.length>0?ht(e):ft(),vt(ff))}return ft()},ff=e=>{const t=Number.parseInt(e);return Number.isNaN(t)?ft():ht(t)},hf=Symbol.for("effect/Console"),gf=ds(hf),pf={[hf]:hf,assert:(e,...t)=>pu((()=>{console.assert(e,...t)})),clear:pu((()=>{console.clear()})),count:e=>pu((()=>{console.count(e)})),countReset:e=>pu((()=>{console.countReset(e)})),debug:(...e)=>pu((()=>{console.debug(...e)})),dir:(e,t)=>pu((()=>{console.dir(e,t)})),dirxml:(...e)=>pu((()=>{console.dirxml(...e)})),error:(...e)=>pu((()=>{console.error(...e)})),group:e=>pu(e?.collapsed?()=>console.groupCollapsed(e?.label):()=>console.group(e?.label)),groupEnd:pu((()=>{console.groupEnd()})),info:(...e)=>pu((()=>{console.info(...e)})),log:(...e)=>pu((()=>{console.log(...e)})),table:(e,t)=>pu((()=>{console.table(e,t)})),time:e=>pu((()=>console.time(e))),timeEnd:e=>pu((()=>console.timeEnd(e))),timeLog:(e,...t)=>pu((()=>{console.timeLog(e,...t)})),trace:(...e)=>pu((()=>{console.trace(...e)})),warn:(...e)=>pu((()=>{console.warn(...e)})),unsafe:console},mf=Symbol.for("effect/Random"),df=ds(mf);class yf{seed;[mf]=mf;PRNG;constructor(e){this.seed=e,this.PRNG=new N(e)}get next(){return pu((()=>this.PRNG.number()))}get nextBoolean(){return ou(this.next,(e=>e>.5))}get nextInt(){return pu((()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER)))}nextRange(e,t){return ou(this.next,(r=>(t-e)*r+e))}nextIntBetween(e,t){return pu((()=>this.PRNG.integer(t-e)+e))}shuffle(e){return bf(e,(e=>this.nextIntBetween(0,e)))}}const bf=(e,t)=>gu((()=>a(pu((()=>Array.from(e))),Xc((e=>{const r=[];for(let t=e.length;t>=2;t-=1)r.push(t);return a(r,iu((r=>a(t(r),ou((t=>_f(e,r-1,t)))))),Pc(jn(e)))}))))),_f=(e,t,r)=>{const n=e[t];return e[t]=e[r],e[r]=n,e},Sf=e=>new yf(e),wf=a(ys(),_s(Fl,Al()),_s(gf,pf),_s(df,Sf(4294967296*Math.random()>>>0)),_s(Xl,tf()),_s(kc,xc)),vf=l(Symbol.for("effect/DefaultServices/currentServices"),(()=>Lu(wf))),kf=Symbol.for("effect/FiberRefs");class Of{locals;[kf]=kf;constructor(e){this.locals=e}pipe(){return Y(this,arguments)}}const If=(e,t,r,n=!1)=>{const s=e;let i,a=t,o=r,c=n;for(;void 0===i;)if(qt(a)&&qt(o)){const e=zt(a)[0],t=Vt(a),r=zt(o)[0],n=zt(o)[1],s=Vt(o);e.startTimeMillis<r.startTimeMillis?(o=s,c=!0):e.startTimeMillis>r.startTimeMillis?a=t:e.id<r.id?(o=s,c=!0):e.id>r.id?a=t:i=[n,c]}else i=[s.initial,!0];return i},Nf=e(3,((e,t,r)=>{const n=new Map(e.locals);for(const[e,s]of r.locals){const r=zt(s)[1];if(!$(zt(s)[0],t)){if(!n.has(e)){if($(r,e.initial))continue;n.set(e,[[t,e.join(e.initial,r)]]);continue}const i=n.get(e),[a,o]=If(e,i,s);if(o){const s=e.diff(a,r),o=zt(i)[1],c=e.join(o,e.patch(s)(o));if(!$(o,c)){let r;const s=zt(i)[0];r=$(s,t)?Lt([s,c])(Vt(i)):Lt([t,c])(i),n.set(e,r)}}}}return new Of(new Map(n))})),xf=e(2,((e,t)=>{const r=new Map;for(const[n,s]of e.locals.entries()){const e=zt(s)[1],i=n.patch(n.fork)(e);$(e,i)?r.set(n,s):r.set(n,Lt([t,i])(s))}return new Of(r)})),Tf=e(2,((e,t)=>{const r=new Map(e.locals);return r.delete(t),new Of(r)})),Ff=e(2,((e,t)=>e.locals.has(t)?ht(zt(e.locals.get(t))[1]):ft())),Mf=e(2,((e,t)=>a(Ff(e,t),yt((()=>t.initial))))),Rf=e(2,((e,{fiberId:t,fiberRef:r,value:n})=>{const s=e.locals.has(r)?e.locals.get(r):[];let i;if(Pt(s))i=Qt([t,n]);else{const[r,a]=zt(s);if($(r,t)){if($(a,n))return e;i=Lt([t,n])(Vt(s))}else i=Lt([t,n])(s)}const a=new Map(e.locals);return new Of(a.set(r,i))})),Ef=Mf,Cf=Iu,Af=Et(a(ir,Mt((e=>e.ordinal)))),jf=e=>t=>`${t.label.replace(/[\s="]/g,"_")}=${e-t.startTime}ms`,Lf="Empty",Kf="Remove",Pf="Update",Bf="AndThen",qf={_tag:Lf},$f=e(2,((e,t)=>({_tag:Bf,first:e,second:t}))),Jf=e(3,((e,t,r)=>{let n=r,s=Qt(e);for(;qt(s);){const e=zt(s),r=Vt(s);switch(e._tag){case Lf:s=r;break;case"Add":n=Rf(n,{fiberId:t,fiberRef:e.fiberRef,value:e.value}),s=r;break;case Kf:n=Tf(n,e.fiberRef),s=r;break;case Pf:{const i=Mf(n,e.fiberRef);n=Rf(n,{fiberId:t,fiberRef:e.fiberRef,value:e.fiberRef.patch(e.patch)(i)}),s=r;break}case Bf:s=Lt(e.first)(Lt(e.second)(r))}}return n})),Uf="effect/MetricLabel",Df=Symbol.for(Uf);class zf{key;value;[Df]=Df;constructor(e,t){this.key=e,this.value=t}[M](){return a(R(Uf),C(R(this.key)),C(R(this.value)))}[q](e){return Vf(e)&&this.key===e.key&&this.value===e.value}pipe(){return Y(this,arguments)}}const Vf=e=>w(e,Df);Symbol.iterator,Symbol.iterator;const Gf=Symbol.for("effect/MutableHashMap"),Hf={[Gf]:Gf,[Symbol.iterator](){return this.backingMap.current[Symbol.iterator]()},toString(){return W(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(H)}},[G](){return this.toJSON()},pipe(){return Y(this,arguments)}},Wf=()=>(e=>{const t=Object.create(Hf);return t.backingMap=zi(e),t})(la()),Yf=e(2,((e,t)=>ha(e.backingMap.current,t))),Qf=e(2,((e,t)=>mt(Yf(e,t)))),Xf=e(3,((e,t,r)=>(Wi(e.backingMap,ga(t,r)),e)));class Zf{buckets=[];scheduleTask(e,t){let r,n;for(n=0;n<this.buckets.length&&this.buckets[n][0]<=t;n++)r=this.buckets[n];if(r)r[1].push(e);else{const r=[];for(let e=0;e<n;e++)r.push(this.buckets[e]);r.push([t,[e]]);for(let e=n;e<this.buckets.length;e++)r.push(this.buckets[e]);this.buckets=r}}}class eh{maxNextTickBeforeTimer;running=!1;tasks=new Zf;constructor(e){this.maxNextTickBeforeTimer=e}starveInternal(e){const t=this.tasks.buckets;this.tasks.buckets=[];for(const[e,r]of t)for(let e=0;e<r.length;e++)r[e]();0===this.tasks.buckets.length?this.running=!1:this.starve(e)}starve(e=0){e>=this.maxNextTickBeforeTimer?xl((()=>this.starveInternal(0)),0):Promise.resolve(void 0).then((()=>this.starveInternal(e+1)))}shouldYield(e){return e.currentOpCount>e.getFiberRef($u)&&e.getFiberRef(qu)}scheduleTask(e,t){this.tasks.scheduleTask(e,t),this.running||(this.running=!0,this.starve())}}const th=l(Symbol.for("effect/Scheduler/defaultScheduler"),(()=>new eh(2048))),rh=l(Symbol.for("effect/FiberRef/currentScheduler"),(()=>Au(th))),nh={_tag:"Sequential"},sh={_tag:"Parallel"},ih="effect/FiberStatus",ah=Symbol.for(ih),oh="Done",ch="Running",uh="Suspended";class lh{[ah]=ah;_tag=oh;[M](){return a(R(ih),C(R(this._tag)))}[q](e){return gh(e)&&e._tag===oh}}class fh{runtimeFlags;[ah]=ah;_tag=ch;constructor(e){this.runtimeFlags=e}[M](){return a(R(ih),C(R(this._tag)),C(R(this.runtimeFlags)))}[q](e){return gh(e)&&e._tag===ch&&this.runtimeFlags===e.runtimeFlags}}class hh{runtimeFlags;blockingOn;[ah]=ah;_tag=uh;constructor(e,t){this.runtimeFlags=e,this.blockingOn=t}[M](){return a(R(ih),C(R(this._tag)),C(R(this.runtimeFlags)),C(R(this.blockingOn)))}[q](e){return gh(e)&&e._tag===uh&&this.runtimeFlags===e.runtimeFlags&&$(this.blockingOn,e.blockingOn)}}const gh=e=>w(e,ah),ph=new lh,mh=e=>new fh(e),dh="InterruptSignal",yh="Stateful",bh="Resume",_h="YieldNow",Sh=e=>({_tag:dh,cause:e}),wh=e=>({_tag:yh,onFiber:e}),vh=e=>({_tag:bh,effect:e}),kh=Symbol.for("effect/FiberScope");class Oh{[kh]=kh;fiberId=ca;roots=new Set;add(e,t){this.roots.add(t),t.addObserver((()=>{this.roots.delete(t)}))}}class Ih{fiberId;parent;[kh]=kh;constructor(e,t){this.fiberId=e,this.parent=t}add(e,t){this.parent.tell(wh((e=>{e.addChild(t),t.addObserver((()=>{e.removeChild(t)}))})))}}const Nh=l(Symbol.for("effect/FiberScope/Global"),(()=>new Oh)),xh=Symbol.for("effect/Fiber"),Th={_E:e=>e,_A:e=>e},Fh=Symbol.for("effect/Fiber"),Mh="effect/FiberCurrent",Rh=je,Eh=nh,Ch=sh,Ah=e=>({_tag:"ParallelN",parallelism:e}),jh=(e,t)=>{const r=new Map(e.locals);let n=qf;for(const[e,s]of t.locals.entries()){const t=zt(s)[1],i=r.get(e);if(void 0!==i){const r=zt(i)[1];$(r,t)||(n=$f({_tag:Pf,fiberRef:e,patch:e.diff(r,t)})(n))}else n=$f({_tag:"Add",fiberRef:e,value:t})(n);r.delete(e)}for(const[e]of r.entries())n=$f({_tag:Kf,fiberRef:e})(n);return n},Lh=Jf,Kh=(e,t)=>({_tag:"Par",left:e,right:t}),Ph=(e,t)=>({_tag:"Seq",left:e,right:t}),Bh=e=>{let t=e,r=Dh(),n=Fa(),s=Fa();for(;;)switch(t._tag){case"Empty":if(Na(n))return[r,s];t=n.head,n=n.tail;break;case"Par":n=Ta(t.right,n),t=t.left;break;case"Seq":{const e=t.left,r=t.right;switch(e._tag){case"Empty":t=r;break;case"Par":{const n=e.left,s=e.right;t=Kh(Ph(n,r),Ph(s,r));break}case"Seq":{const n=e.left,s=e.right;t=Ph(n,Ph(s,r));break}case"Single":t=e,s=Ta(r,s)}break}case"Single":if(r=Vh(r,zh(t.dataSource,t.blockedRequest)),Na(n))return[r,s];t=n.head,n=n.tail}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},qh=(e,t)=>{if(Na(e))return Ma(Wh(t));if(Gh(t))return e;const r=tg(e.head),n=Hh(t);return 1===r.length&&1===n.length&&$(r[0],n[0])?Ta(eg(e.head,Wh(t)),e.tail):Ta(Wh(t),e)},$h=Symbol.for("effect/RequestBlock/RequestBlockParallel"),Jh={_R:e=>e};class Uh{map;[$h]=Jh;constructor(e){this.map=e}}const Dh=()=>new Uh(la()),zh=(e,t)=>new Uh(((...e)=>Zs(e))([e,Array.of(t)])),Vh=(e,t)=>new Uh(ya(e.map,t.map,((e,t,r)=>ga(e,r,dt(ha(e,r),{onNone:()=>t,onSome:e=>[...e,...t]}))))),Gh=e=>(e=>e&&js(e._root))(e.map),Hh=e=>Array.from(pa(e.map)),Wh=e=>Zh(da(e.map,(e=>Array.of(e)))),Yh=Symbol.for("effect/RequestBlock/RequestBlockSequential"),Qh={_R:e=>e};class Xh{map;[Yh]=Qh;constructor(e){this.map=e}}const Zh=e=>new Xh(e),eg=(e,t)=>new Xh(ya(t.map,e.map,((e,t,r)=>ga(e,r,dt(ha(e,r),{onNone:()=>[],onSome:e=>[...e,...t]}))))),tg=e=>Array.from(pa(e.map)),rg=l(Symbol.for("effect/FiberRef/currentRequestMap"),(()=>Au(new Map))),ng=(e,t,r,n)=>{switch(e){case void 0:return t();case"unbounded":return r();case"inherit":return Mu(Vu,(e=>"unbounded"===e?r():e>1?n(e):t()));default:return e>1?n(e):t()}},sg=Symbol.for("effect/Logger"),ig={_Message:e=>e,_Output:e=>e},ag=e=>({[sg]:ig,log:e,pipe(){return Y(this,arguments)}}),og=ag((({annotations:e,cause:t,date:r,fiberId:n,logLevel:s,message:i,spans:o})=>{const c=r.getTime();let u=[`timestamp=${r.toISOString()}`,`level=${s.label}`,`fiber=${oa(n)}`].join(" ");const l=cg(i);if(l.length>0&&(u+=" message=",u=lg(l,u)),null!=t&&"Empty"!==t._tag&&(u+=" cause=",u=lg(lc(t),u)),xa(o)){u+=" ";let e=!0;for(const t of o)e?e=!1:u+=" ",u+=a(t,jf(c))}if(a(e,ma)>0){u+=" ";let t=!0;for(const[r,n]of e)t?t=!1:u+=" ",u+=fg(r),u+="=",u=lg(cg(n),u)}return u})),cg=e=>{try{return"object"==typeof e?JSON.stringify(e):String(e)}catch(t){return String(e)}},ug=/^[^\s"=]+$/,lg=(e,t)=>t+(e.match(ug)?e:`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`),fg=e=>e.replace(/[\s="]/g,"_"),hg=Symbol.for("effect/MetricKeyType"),gg="effect/MetricKeyType/Counter",pg=Symbol.for(gg),mg=Symbol.for("effect/MetricKeyType/Frequency"),dg=Symbol.for("effect/MetricKeyType/Gauge"),yg="effect/MetricKeyType/Histogram",bg=Symbol.for(yg),_g=Symbol.for("effect/MetricKeyType/Summary"),Sg={_In:e=>e,_Out:e=>e};class wg{incremental;bigint;[hg]=Sg;[pg]=pg;constructor(e,t){this.incremental=e,this.bigint=t}[M](){return R(gg)}[q](e){return kg(e)}pipe(){return Y(this,arguments)}}class vg{boundaries;[hg]=Sg;[bg]=bg;constructor(e){this.boundaries=e}[M](){return a(R(yg),C(R(this.boundaries)))}[q](e){return Og(e)&&$(this.boundaries,e.boundaries)}pipe(){return Y(this,arguments)}}const kg=e=>w(e,pg),Og=e=>w(e,bg),Ig=Symbol.for("effect/MetricKey"),Ng={_Type:e=>e};class xg{name;keyType;description;tags;[Ig]=Ng;constructor(e,t,r,n=Ci()){this.name=e,this.keyType=t,this.description=r,this.tags=n}[M](){return a(R(this.name),C(R(this.keyType)),C(R(this.description)),C(R(this.tags)))}[q](e){return Tg(e)&&this.name===e.name&&$(this.keyType,e.keyType)&&$(this.description,e.description)&&$(this.tags,e.tags)}pipe(){return Y(this,arguments)}}const Tg=e=>w(e,Ig),Fg=e(2,((e,t)=>0===Ki(t)?e:new xg(e.name,e.keyType,e.description,a(e.tags,$i(t))))),Mg=Symbol.for("effect/MetricState"),Rg="effect/MetricState/Counter",Eg=Symbol.for(Rg),Cg="effect/MetricState/Frequency",Ag=Symbol.for(Cg),jg="effect/MetricState/Gauge",Lg=Symbol.for(jg),Kg="effect/MetricState/Histogram",Pg=Symbol.for(Kg),Bg="effect/MetricState/Summary",qg=Symbol.for(Bg),$g={_A:e=>e};class Jg{count;[Mg]=$g;[Eg]=Eg;constructor(e){this.count=e}[M](){return a(R(Rg),C(R(this.count)))}[q](e){return Gg(e)&&this.count===e.count}pipe(){return Y(this,arguments)}}class Ug{occurrences;[Mg]=$g;[Ag]=Ag;constructor(e){this.occurrences=e}[M](){return a(R(Cg),C(R(this.occurrences)))}[q](e){return Hg(e)&&$(this.occurrences,e.occurrences)}pipe(){return Y(this,arguments)}}class Dg{value;[Mg]=$g;[Lg]=Lg;constructor(e){this.value=e}[M](){return a(R(jg),C(R(this.value)))}[q](e){return Wg(e)&&this.value===e.value}pipe(){return Y(this,arguments)}}class zg{buckets;count;min;max;sum;[Mg]=$g;[Pg]=Pg;constructor(e,t,r,n,s){this.buckets=e,this.count=t,this.min=r,this.max=n,this.sum=s}[M](){return a(R(Kg),C(R(this.buckets)),C(R(this.count)),C(R(this.min)),C(R(this.max)),C(R(this.sum)))}[q](e){return Yg(e)&&$(this.buckets,e.buckets)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return Y(this,arguments)}}class Vg{error;quantiles;count;min;max;sum;[Mg]=$g;[qg]=qg;constructor(e,t,r,n,s,i){this.error=e,this.quantiles=t,this.count=r,this.min=n,this.max=s,this.sum=i}[M](){return a(R(Bg),C(R(this.error)),C(R(this.quantiles)),C(R(this.count)),C(R(this.min)),C(R(this.max)),C(R(this.sum)))}[q](e){return Qg(e)&&this.error===e.error&&$(this.quantiles,e.quantiles)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return Y(this,arguments)}}const Gg=e=>w(e,Eg),Hg=e=>w(e,Ag),Wg=e=>w(e,Lg),Yg=e=>w(e,Pg),Qg=e=>w(e,qg),Xg=Symbol.for("effect/MetricHook"),Zg={_In:e=>e,_Out:e=>e},ep=e=>({[Xg]:Zg,pipe(){return Y(this,arguments)},...e}),tp=BigInt(0),rp=(e,t,r)=>{const n=r.length;if(Gn(t))return Cn();const s=Yn(t),i=a(t,zn(1)),o=a(i,tr(An(np(e,n,ft(),0,s,r)),((t,r)=>{const s=Yn(t);return a(t,Jn(np(e,n,s.value,s.consumed,r,s.rest)))})));return a(o,Xn((e=>[e.quantile,e.value])))},np=(e,t,r,n,s,i)=>{let o=e,c=t,u=r,l=n,f=s,h=i,g=e,p=t,m=r,d=n,y=s,b=i;for(;;){if(Gn(h))return{quantile:f,value:ft(),consumed:l,rest:Cn()};if(1===f)return{quantile:f,value:ht((_=h,$n(_,_.length-1))),consumed:l+h.length,rest:Cn()};const e=a(h,ts((e=>e>Yn(h)))),t=f*c,r=o/2*t,n=l+e[0].length,s=Math.abs(n-t);if(n<t-r)g=o,p=c,m=Wn(h),d=n,y=f,b=e[1],o=g,c=p,u=m,l=d,f=y,h=b;else{if(n>t+r)return{quantile:f,value:u,consumed:l,rest:h};switch(u._tag){case"None":g=o,p=c,m=Wn(h),d=n,y=f,b=e[1],o=g,c=p,u=m,l=d,f=y,h=b;continue;case"Some":if(s<Math.abs(t-u.value)){g=o,p=c,m=Wn(h),d=n,y=f,b=e[1],o=g,c=p,u=m,l=d,f=y,h=b;continue}return{quantile:f,value:ht(u.value),consumed:l,rest:h}}}}var _;throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},sp=Symbol.for("effect/MetricPair"),ip={_Type:e=>e},ap=(e,t)=>({[sp]:ip,metricKey:e,metricState:t,pipe(){return Y(this,arguments)}}),op=Symbol.for("effect/MetricRegistry");class cp{[op]=op;map=Wf();snapshot(){const e=[];for(const[t,r]of this.map)e.push(ap(t,r.get()));return Ai(e)}get(e){const t=a(this.map,Yf(e),St);if(null==t){if(kg(e.keyType))return this.getCounter(e);if(r=e.keyType,w(r,dg))return this.getGauge(e);if((e=>w(e,mg))(e.keyType))return this.getFrequency(e);if(Og(e.keyType))return this.getHistogram(e);if((e=>w(e,_g))(e.keyType))return this.getSummary(e);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}var r;return t}getCounter(e){let t=a(this.map,Yf(e),St);if(null==t){const r=(e=>{let t=e.keyType.bigint?tp:0;const r=e.keyType.incremental?e.keyType.bigint?e=>e>=tp:e=>e>=0:e=>!0;return ep({get:()=>new Jg(t),update:e=>{r(e)&&(t+=e)}})})(e);a(this.map,Qf(e))||a(this.map,Xf(e,r)),t=r}return t}getFrequency(e){let t=a(this.map,Yf(e),St);if(null==t){const r=(e=>{let t=0;const r=new Map;return ep({get:()=>{return e=fa(r.entries()),new Ug(e);var e},update:e=>{t+=1;const n=r.get(e)??0;r.set(e,n+1)}})})();a(this.map,Qf(e))||a(this.map,Xf(e,r)),t=r}return t}getGauge(e){let t=a(this.map,Yf(e),St);if(null==t){const r=((e,t)=>{let r=t;return ep({get:()=>new Dg(r),update:e=>{r=e}})})(0,e.keyType.bigint?BigInt(0):0);a(this.map,Qf(e))||a(this.map,Xf(e,r)),t=r}return t}getHistogram(e){let t=a(this.map,Yf(e),St);if(null==t){const r=(e=>{const t=e.keyType.boundaries.values,r=t.length,n=new Uint32Array(r+1),s=new Float32Array(r);let i=0,o=0,c=Number.MAX_VALUE,u=Number.MIN_VALUE;a(t,Zn(ir),Xn(((e,t)=>{s[t]=e})));const l=()=>{const e=Array(r);let t=0;for(let i=0;i<r;i++){const r=s[i];t+=n[i],e[i]=[r,t]}return qn(e)};return ep({get:()=>{return e={buckets:l(),count:i,min:c,max:u,sum:o},new zg(e.buckets,e.count,e.min,e.max,e.sum);var e},update:e=>{let t=0,a=r;for(;t!==a;){const r=Math.floor(t+(a-t)/2);e<=s[r]?a=r:t=r,a===t+1&&(e<=s[t]?a=t:t=a)}n[t]=n[t]+1,i+=1,o+=e,e<c&&(c=e),e>u&&(u=e)}})})(e);a(this.map,Qf(e))||a(this.map,Xf(e,r)),t=r}return t}getSummary(e){let t=a(this.map,Yf(e),St);if(null==t){const r=(e=>{const{error:t,maxAge:r,maxSize:n,quantiles:s}=e.keyType,i=a(s,Zn(ir)),o=Array(n);let c=0,u=0,l=0,f=Number.MAX_VALUE,h=Number.MIN_VALUE;const g=e=>{const s=[];let c=0;for(;c!==n-1;){const t=o[c];if(null!=t){const[n,i]=t,a=le(e-n);_e(a,oe)&&a<=r&&s.push(i)}c+=1}return rp(t,i,a(qn(s),Zn(ir)))};return ep({get:()=>{return e={error:t,quantiles:g(Date.now()),count:u,min:f,max:h,sum:l},new Vg(e.error,e.quantiles,e.count,e.min,e.max,e.sum);var e},update:([e,t])=>((e,t)=>{n>0&&(c+=1,o[c%n]=[t,e]),u+=1,l+=e,e<f&&(f=e),e>h&&(h=e)})(e,t)})})(e);a(this.map,Qf(e))||a(this.map,Xf(e,r)),t=r}return t}}const up=Symbol.for("effect/Metric"),lp={_Type:e=>e,_In:e=>e,_Out:e=>e},fp=l(Symbol.for("effect/Metric/globalMetricRegistry"),(()=>new cp)),hp=function(e,t,r){const n=Object.assign((e=>mu(e,(e=>pu((()=>t(e,Ci())))))),{[up]:lp,keyType:e,unsafeUpdate:t,unsafeValue:r,register(){return this.unsafeValue(Ci()),this},pipe(){return Y(this,arguments)}});return n},gp=(e,t)=>pp(((e,t)=>new xg(e,(e=>new wg(e?.incremental??!1,e?.bigint??!1))(t),_t(t?.description)))(e,t)),pp=e=>{const t=t=>{const r=a(e,Fg(t));return fp.get(r)};return hp(e.keyType,((e,r)=>t(r).update(e)),(e=>t(e).get()))},mp=(e,t,r)=>pp(((e,t,r)=>new xg(e,(e=>new vg(e))(t),_t(r)))(e,t,r)),dp=e(3,((e,t,r)=>yp(e,ji(((e,t)=>new zf(e,t))(t,r))))),yp=e(2,((e,t)=>{const r=Ei(t)?t:Ai(t);return hp(e.keyType,((t,n)=>e.unsafeUpdate(t,a(r,$i(n)))),(t=>e.unsafeValue(a(r,$i(t)))))})),bp="effect/MetricBoundaries",_p=Symbol.for(bp);class Sp{values;[_p]=_p;constructor(e){this.values=e}[M](){return a(R(bp),C(R(this.values)))}[q](e){return wp(e)&&$(this.values,e.values)}pipe(){return Y(this,arguments)}}const wp=e=>w(e,_p),vp=e=>{const t=a(e,Vn(An(Number.POSITIVE_INFINITY)),ns);return new Sp(t)},kp=e=>a(((e,t)=>{const r=Math.max(1,Math.floor(e)),n=[t(0)];for(let e=1;e<r;e++)n.push(t(e));return n})(e.count-1,(t=>e.start*Math.pow(e.factor,t))),qn,vp),Op=e(2,((e,t)=>Mu(rg,(r=>pu((()=>{if(r.has(e)){const n=r.get(e);n.state.completed||(n.state.completed=!0,bl(n.result,t))}})))))),Ip=Symbol.for("effect/Supervisor"),Np={_T:e=>e};class xp{underlying;value0;[Ip]=Np;constructor(e,t){this.underlying=e,this.value0=t}get value(){return this.value0}onStart(e,t,r,n){this.underlying.onStart(e,t,r,n)}onEnd(e,t){this.underlying.onEnd(e,t)}onEffect(e,t){this.underlying.onEffect(e,t)}onSuspend(e){this.underlying.onSuspend(e)}onResume(e){this.underlying.onResume(e)}map(e){return new xp(this,a(this.value,ou(e)))}zip(e){return new Tp(this,e)}}class Tp{left;right;_tag="Zip";[Ip]=Np;constructor(e,t){this.left=e,this.right=t}get value(){return wu(this.left.value,this.right.value)}onStart(e,t,r,n){this.left.onStart(e,t,r,n),this.right.onStart(e,t,r,n)}onEnd(e,t){this.left.onEnd(e,t),this.right.onEnd(e,t)}onEffect(e,t){this.left.onEffect(e,t),this.right.onEffect(e,t)}onSuspend(e){this.left.onSuspend(e),this.right.onSuspend(e)}onResume(e){this.left.onResume(e),this.right.onResume(e)}map(e){return new xp(this,a(this.value,ou(e)))}zip(e){return new Tp(this,e)}}const Fp=e=>w(e,Ip)&&v(e,"Zip");class Mp{effect;[Ip]=Np;constructor(e){this.effect=e}get value(){return this.effect}onStart(e,t,r,n){}onEnd(e,t){}onEffect(e,t){}onSuspend(e){}onResume(e){}map(e){return new xp(this,a(this.value,ou(e)))}zip(e){return new Tp(this,e)}onRun(e,t){return e()}}const Rp=l("effect/Supervisor/none",(()=>new Mp(bu))),Ep="Empty",Cp="AddSupervisor",Ap="RemoveSupervisor",jp="AndThen",Lp={_tag:Ep},Kp=(e,t)=>({_tag:jp,first:e,second:t}),Pp=(e,t)=>$(e,t)?Rp:Fp(e)?Pp(e.left,t).zip(Pp(e.right,t)):e,Bp=e=>$(e,Rp)?Ci():Fp(e)?a(Bp(e.left),$i(Bp(e.right))):ji(e),qp=fo({empty:Lp,patch:(e,t)=>((e,t)=>{let r=e,n=t;for(;Hn(n);){const e=Qn(n);switch(e._tag){case Ep:n=rs(n);break;case Cp:r=r.zip(e.supervisor),n=rs(n);break;case Ap:r=Pp(r,e.supervisor),n=rs(n);break;case jp:n=Un(e.first)(Un(e.second)(rs(n)))}}return r})(t,An(e)),combine:Kp,diff:(e,t)=>{if($(e,t))return Lp;const r=Bp(e),n=Bp(t),s=a(n,qi(r),Ji(Lp,((e,t)=>Kp(e,{_tag:Cp,supervisor:t})))),i=a(r,qi(n),Ji(Lp,((e,t)=>Kp(e,{_tag:Ap,supervisor:t}))));return Kp(s,i)}}),$p=gp("effect_fiber_started"),Jp=gp("effect_fiber_active"),Up=gp("effect_fiber_successes"),Dp=gp("effect_fiber_failures"),zp=dp(mp("effect_fiber_lifetimes",kp({start:1,factor:1.3,count:100})),"time_unit","milliseconds"),Vp="Continue",Gp="Yield",Hp={_E:e=>e,_A:e=>e},Wp=e=>{throw new Error(`BUG: FiberRuntime - ${JSON.stringify(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},Yp={[Ne]:(e,t,r)=>t.i1(r),OnStep:(e,t,r)=>gl(gl(r)),[xe]:(e,t,r)=>t.i2(r),[Ae]:(e,t,r)=>(e.patchRuntimeFlags(e._runtimeFlags,t.patch),ko(e._runtimeFlags)&&e.isInterrupted()?ll(e.getInterruptedCause()):gl(r)),[Re]:(e,t,r)=>(t.i2(r),t.i0()?(e.pushStack(t),t.i1()):bu)},Qp={[dh]:(e,t,r,n)=>(e.processNewInterruptSignal(n.cause),ko(t)?ll(n.cause):r),[bh]:(e,t,r,n)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[yh]:(e,t,r,n)=>(n.onFiber(e,mh(t)),r),[_h]:(e,t,r,n)=>Xc(Su(),(()=>r))};class Xp{[xh]=Th;[Fh]=Hp;pipe(){return Y(this,arguments)}_fiberRefs;_fiberId;_runtimeFlags;_queue=new Array;_children=null;_observers=new Array;_running=!1;_stack=[];_asyncInterruptor=null;_asyncBlockingOn=null;_exitValue=null;_steps=[];_supervisor;_scheduler;_tracer;currentOpCount=0;isYielding=!1;constructor(e,t,r){if(this._runtimeFlags=r,this._fiberId=e,this._fiberRefs=t,this._supervisor=this.getFiberRef(_m),this._scheduler=this.getFiberRef(rh),xo(r)){const e=this.getFiberRef(Wu);$p.unsafeUpdate(1,e),Jp.unsafeUpdate(1,e)}this._tracer=Ss(this.getFiberRef(vf),kc)}id(){return this._fiberId}resume(e){this.tell(vh(e))}get status(){return this.ask(((e,t)=>t))}get runtimeFlags(){return this.ask(((e,t)=>t._tag===oh?e._runtimeFlags:t.runtimeFlags))}scope(){return new Ih((e=this).id(),e);var e}get children(){return this.ask((e=>Array.from(e.getChildren())))}getChildren(){return null===this._children&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(Qu)}fiberRefs(){return this.ask((e=>e.getFiberRefs()))}ask(e){return gu((()=>{const t=yl(this._fiberId);return this.tell(wh(((r,n)=>{bl(t,pu((()=>e(r,n))))}))),$c((e=>{const t=Vi(r.state);switch(t._tag){case yc:return at(t.effect);case dc:return a(r.state,Gi(Sc([e,...t.joiners]))),ot(_l(r,e))}}),(r=t).blockingOn);var r}))}tell(e){this._queue.push(e),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return qc((e=>{const t=t=>e(hu(t));return this.tell(wh(((e,r)=>{null!==e._exitValue?t(this._exitValue):e.addObserver(t)}))),pu((()=>this.tell(wh(((e,r)=>{e.removeObserver(t)})))))}),this.id())}get inheritAll(){return Lc(((e,t)=>{const r=e.id(),n=e.getFiberRefs(),s=t.runtimeFlags,i=this.getFiberRefs(),o=Nf(n,r,i);e.setFiberRefs(o);const c=e.getFiberRef(bm);return(e=>{const t=new Ec(Me);return t.i0=e,t.i1=void 0,t})(a(Fo(s,c),Co(1),Co(16)))}))}get poll(){return pu((()=>_t(this._exitValue)))}unsafePoll(){return this._exitValue}interruptAsFork(e){return pu((()=>this.tell(Sh(Vo(e)))))}unsafeInterruptAsFork(e){this.tell(Sh(Vo(e)))}addObserver(e){null!==this._exitValue?e(this._exitValue):this._observers.push(e)}removeObserver(e){this._observers=this._observers.filter((t=>t!==e))}getFiberRefs(){return this.setFiberRef(bm,this._runtimeFlags),this._fiberRefs}unsafeDeleteFiberRef(e){this._fiberRefs=Tf(this._fiberRefs,e)}getFiberRef(e){return this._fiberRefs.locals.has(e)?this._fiberRefs.locals.get(e)[0][1]:e.initial}setFiberRef(e,t){this._fiberRefs=Rf(this._fiberRefs,{fiberId:this._fiberId,fiberRef:e,value:t}),this.refreshRefCache()}refreshRefCache(){this._tracer=Ss(this.getFiberRef(vf),kc),this._supervisor=this.getFiberRef(_m),this._scheduler=this.getFiberRef(rh)}setFiberRefs(e){this._fiberRefs=e,this.refreshRefCache()}addChild(e){this.getChildren().add(e)}removeChild(e){this.getChildren().delete(e)}drainQueueOnCurrentThread(){let e=!0;for(;e;){let t=Vp;const r=globalThis[Mh];globalThis[Mh]=this;try{for(;t===Vp;)t=0===this._queue.length?"Done":this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[Mh]=r}this._queue.length>0&&!this._running?(this._running=!0,t===Gp?(this.drainQueueLaterOnExecutor(),e=!1):e=!0):e=!1}}drainQueueLaterOnExecutor(){this._scheduler.scheduleTask(this.run,this.getFiberRef(qu))}drainQueueWhileRunning(e,t){let r=t;for(;this._queue.length>0;){const t=this._queue.splice(0,1)[0];r=Qp[t._tag](this,e,r,t)}return r}isInterrupted(){return!((e=this.getFiberRef(Qu))._tag===jo||cc(e,!0,((e,t)=>{switch(t._tag){case jo:return ht(e);case Ao:case Lo:case Ko:return ht(!1);default:return ft()}})));var e}addInterruptedCause(e){const t=this.getFiberRef(Qu);this.setFiberRef(Qu,Ho(t,e))}processNewInterruptSignal(e){this.addInterruptedCause(e),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(null===this._children||0===this._children.size)return!1;let e=!1;for(const t of this._children)t.tell(Sh(Vo(this.id()))),e=!0;return e}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const e=this._children.values();this._children=null;let t=!1;return _u({while:()=>!t,body:()=>{const r=e.next();return r.done?pu((()=>{t=!0})):Bc(r.value.await)},step:()=>{}})}return null}reportExitValue(e){if(xo(this._runtimeFlags)){const t=this.getFiberRef(Wu);switch(Jp.unsafeUpdate(-1,t),e._tag){case Te:Up.unsafeUpdate(1,t);break;case Oe:Dp.unsafeUpdate(1,t)}}if("Failure"===e._tag){const t=this.getFiberRef(Hu);Yo(e.cause)||"Some"!==t._tag||this.log("Fiber terminated with a non handled error",e.cause,t)}}setExitValue(e){if(this._exitValue=e,xo(this._runtimeFlags)){const e=this.getFiberRef(Wu),t=this.id().startTimeMillis,r=(new Date).getTime();zp.unsafeUpdate(r-t,e)}this.reportExitValue(e);for(let t=this._observers.length-1;t>=0;t--)this._observers[t](e)}getLoggers(){return this.getFiberRef(rm)}log(e,t,r){const n=mt(r)?r.value:this.getFiberRef(Uu),s=this.getFiberRef(Zp);if(Af(s,n))return;const i=this.getFiberRef(Du),a=this.getFiberRef(Ju),o=this.getLoggers(),c=this.getFiberRefs();if(Ki(o)>0){const r=Ss(this.getFiberRef(vf),Fl),s=new Date(r.unsafeCurrentTimeMillis());for(const r of o)r.log({fiberId:this.id(),logLevel:n,message:e,cause:t,context:c,spans:i,annotations:a,date:s})}}evaluateMessageWhileSuspended(e){switch(e._tag){case _h:return Gp;case dh:return this.processNewInterruptSignal(e.cause),null!==this._asyncInterruptor&&(this._asyncInterruptor(ll(e.cause)),this._asyncInterruptor=null),Vp;case bh:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(e.effect),Vp;case yh:return e.onFiber(this,null!==this._exitValue?ph:(t=this._runtimeFlags,r=this._asyncBlockingOn,new hh(t,r))),Vp;default:return Wp(e)}var t,r}evaluateEffect(e){this._supervisor.onResume(this);try{let r=ko(this._runtimeFlags)&&this.isInterrupted()?ll(this.getInterruptedCause()):e;for(;null!==r;)try{const e=r,t=this.runLoop(e);this._runtimeFlags=a(this._runtimeFlags,vo(16));const n=this.interruptAllChildren();null!==n?r=Xc(n,(()=>t)):(0===this._queue.length?this.setExitValue(t):this.tell(vh(t)),r=null)}catch(e){if(!jc(e))throw e;e._op===Ce?(t=this._runtimeFlags,Io(t,32)?(this.tell({_tag:_h}),this.tell(vh(pl)),r=null):r=pl):e._op===ve&&(r=null)}}finally{this._supervisor.onSuspend(this)}var t}start(e){if(this._running)this.tell(vh(e));else{this._running=!0;const t=globalThis[Mh];globalThis[Mh]=this;try{this.evaluateEffect(e)}finally{this._running=!1,globalThis[Mh]=t,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(e){this.tell(vh(e))}patchRuntimeFlags(e,t){const r=Mo(e,t);return globalThis[Mh]=this,this._runtimeFlags=r,r}initiateAsync(e,t){let r=!1;const n=e=>{r||(r=!0,this.tell(vh(e)))};ko(e)&&(this._asyncInterruptor=n);try{t(n)}catch(e){n(Wc(zo(e)))}}pushStack(e){this._stack.push(e),"OnStep"===e._op&&this._steps.push({refs:this.getFiberRefs(),flags:this._runtimeFlags})}popStack(){const e=this._stack.pop();if(e)return"OnStep"===e._op&&this._steps.pop(),e}getNextSuccessCont(){let e=this.popStack();for(;e;){if(e._op!==Ie)return e;e=this.popStack()}}getNextFailCont(){let e=this.popStack();for(;e;){if(e._op!==Ne&&e._op!==Re)return e;e=this.popStack()}}Tag(e){return ou(Fu(Bu),(t=>ws(t,e)))}Left(e){return Gc(e.left)}None(e){return Gc(new al)}Right(e){return gl(e.right)}Some(e){return gl(e.value)}[Fe](e){const t=e.i0(),r=this.getNextSuccessCont();if(void 0!==r)return r._op in Yp||Wp(r),Yp[r._op](this,r,t);throw gl(t)}[Te](e){const t=e,r=this.getNextSuccessCont();if(void 0!==r)return r._op in Yp||Wp(r),Yp[r._op](this,r,t.i0);throw t}[Oe](e){const t=e.i0,r=this.getNextFailCont();if(void 0===r)throw ll(t);switch(r._op){case Ie:case xe:return ko(this._runtimeFlags)&&this.isInterrupted()?ll(Xo(t)):r.i1(t);case"OnStep":return ko(this._runtimeFlags)&&this.isInterrupted()?ll(Xo(t)):gl(ll(t));case Ae:return this.patchRuntimeFlags(this._runtimeFlags,r.patch),ko(this._runtimeFlags)&&this.isInterrupted()?ll(Ho(t,this.getInterruptedCause())):ll(t);default:Wp(r)}}[Ee](e){return e.i0(this,mh(this._runtimeFlags))}Blocked(e){const t=this.getFiberRefs(),r=this._runtimeFlags;if(this._steps.length>0){const n=[],s=this._steps[this._steps.length-1];let i=this.popStack();for(;i&&"OnStep"!==i._op;)n.push(i),i=this.popStack();this.setFiberRefs(s.refs),this._runtimeFlags=s.flags;const a=jh(s.refs,t),o=Fo(s.flags,r);return gl(Fc(e.i0,Lc((t=>{for(;n.length>0;)t.pushStack(n.pop());return t.setFiberRefs(Lh(t.id(),t.getFiberRefs())(a)),t._runtimeFlags=Mo(o)(t._runtimeFlags),e.i1}))))}return yu((t=>Xc(om((e=>{const t=new Ec("RunBlocked");return t.i0=e,t})(e.i0)),(()=>t(e.i1)))))}RunBlocked(e){return t=e.i0,iu((e=>{let t=Ma(e),r=Fa();for(;;){const[e,n]=Aa(t,[Dh(),Fa()],(([e,t],r)=>{const[n,s]=Bh(r);return[Vh(e,n),Ra(t,s)]}));if(r=qh(r,e),Na(n))return ja(r);t=n}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")})(t),(e=>im((e=>Array.from(e.map))(e),(([e,t])=>{const r=new Map;for(const e of t)for(const t of e)r.set(t.request,t);return Cu(Sm(e.runAll(t),t.flat()),rg,r)}),!1,!1)));var t}[Me](e){const t=e.i0,r=this._runtimeFlags,n=Mo(r,t);if(ko(n)&&this.isInterrupted())return ll(this.getInterruptedCause());if(this.patchRuntimeFlags(this._runtimeFlags,t),e.i1){const t=Fo(n,r);return this.pushStack(new Rc(t,e)),e.i1(r)}return pl}[Ne](e){return this.pushStack(e),e.i0}OnStep(e){return this.pushStack(e),e.i0}[Ie](e){return this.pushStack(e),e.i0}[xe](e){return this.pushStack(e),e.i0}[ve](e){throw this._asyncBlockingOn=e.i1,this.initiateAsync(this._runtimeFlags,e.i0),e}[Ce](e){throw this.isYielding=!1,e}[Re](e){const t=e.i0,r=e.i1;return t()?(this.pushStack(e),r()):pl}[ke](e){return e.commit()}runLoop(e){let t=e;for(this.currentOpCount=0;;){if(0!=(2&this._runtimeFlags)&&this._supervisor.onEffect(this,t),this._queue.length>0&&(t=this.drainQueueWhileRunning(this._runtimeFlags,t)),!this.isYielding){this.currentOpCount+=1;const e=this._scheduler.shouldYield(this);if(!1!==e){this.isYielding=!0,this.currentOpCount=0;const r=t;t=Xc(Su({priority:e}),(()=>r))}}try{"_op"in t&&t._op in this||Wp(t),t=this._tracer.context((()=>{return o!==t[Rh]._V?(e=`Cannot execute an Effect versioned ${t[Rh]._V} with a Runtime of version ${o}`,Yc((()=>zo(new nl(e))))):this[t._op](t);var e}),this)}catch(e){if(jc(e)){if(e._op===Ce||e._op===ve)throw e;if(e._op===Te||e._op===Oe)return e;t=ll(zo(e))}else t=w(e,Tc)?ll(e.cause):w(e,sl)?ll(Ho(zo(e),Vo(ca))):ll(zo(e))}}}run=()=>{this.drainQueueOnCurrentThread()}}const Zp=l("effect/FiberRef/currentMinimumLogLevel",(()=>Au(Cf))),em=l(Symbol.for("effect/Logger/defaultLogger"),(()=>ag((e=>{const t=og.log(e);(e=>{const t=Ef(e,vf);return Ss(t,gf).unsafe})(e.context).log(t)})))),tm=l(Symbol.for("effect/Logger/tracerLogger"),(()=>ag((({annotations:e,cause:t,context:r,fiberId:n,logLevel:s,message:i})=>{const a=vt(Ff(r,Bu),vs(Oc)),o=wt(Ff(r,vf),(e=>Ss(e,Fl)));if("None"===a._tag||"ExternalSpan"===a.value._tag||"None"===o._tag)return;const c=Object.fromEntries(da(e,(e=>cg(e))));c["effect.fiberId"]=ua(n),c["effect.logLevel"]=s.label,null!==t&&"Empty"!==t._tag&&(c["effect.cause"]=lc(t)),a.value.event(String(i),o.value.unsafeCurrentTimeNanos(),c)})))),rm=l(Symbol.for("effect/FiberRef/currentLoggers"),(()=>ju(ji(em,tm)))),nm=e((e=>{return t=e[0],w(t,Symbol.iterator);var t}),((e,t,r)=>Lc((n=>{const s=!0===r?.batching||"inherit"===r?.batching&&n.getFiberRef(Gu);return r?.discard?ng(r.concurrency,(()=>gm(Eh)((r=>s?im(e,((e,n)=>r(t(e,n))),!0,!1,1):iu(e,((e,n)=>r(t(e,n))))))),(()=>gm(Ch)((r=>im(e,((e,n)=>r(t(e,n))),s,!1)))),(r=>gm(Ah(r))((n=>im(e,((e,r)=>n(t(e,r))),s,!1,r))))):ng(r?.concurrency,(()=>gm(Eh)((r=>s?am(e,1,((e,n)=>r(t(e,n))),!0):su(e,((e,n)=>r(t(e,n))))))),(()=>gm(Ch)((r=>sm(e,((e,n)=>r(t(e,n))),s)))),(r=>gm(Ah(r))((n=>am(e,r,((e,r)=>n(t(e,r))),s)))))})))),sm=(e,t,r)=>gu((()=>{const n=jt(e),s=new Array(n.length);return ku(im(n,((e,r)=>Xc(t(e,r),(e=>pu((()=>s[r]=e))))),r,!1),hu(s))})),im=(e,t,r,n,s)=>yu((i=>(e=>Lc((t=>{const r=a(t.getFiberRef(Yu),yt((()=>t.scope())));return e(Cu(Yu,ht(r)))})))((a=>Lc((o=>{let c=Array.from(e).reverse(),u=c.length;if(0===u)return bu;let l=0,f=!1;const h=s?Math.min(c.length,s):c.length,g=new Set,p=new Array,m=new Array,d=new Array,y=new Array,b=()=>{const e=p.filter((({exit:e})=>"Failure"===e._tag)).sort(((e,t)=>e.index<t.index?-1:e.index===t.index?0:1)).map((({exit:e})=>e));return 0===e.length&&e.push(pl),e},_=e=>{const t=du(a(e)),r=cm(t,o,o._runtimeFlags,Nh);return o._scheduler.scheduleTask((()=>{r.resume(t)}),0),r},S=()=>{n||(u-=c.length,c=[]),f=!0,g.forEach((e=>{e._scheduler.scheduleTask((()=>{e.unsafeInterruptAsFork(o.id())}),0)}))},w=r?Zc:Vc,v=_(qc((e=>{const n=(e,t)=>{"Blocked"===e._op?y.push(e):(p.push({index:t,exit:e}),"Failure"!==e._op||f||S())},a=()=>{if(c.length>0){const h=c.pop();let S=l++;const v=()=>{const e=c.pop();return S=l++,Xc(Su(),(()=>Xc(w(i(t(e,S))),k)))},k=e=>c.length>0&&(n(e,S),c.length>0)?v():hu(e),O=Xc(w(i(t(h,S))),k),I=_(O);m.push(I),g.add(I),f&&I._scheduler.scheduleTask((()=>{I.unsafeInterruptAsFork(o.id())}),0),I.addObserver((t=>{let i;if(i="Failure"===t._op?t:t.i0,d.push(I),g.delete(I),n(i,S),p.length===u)e(hu(yt(ul(b(),{parallel:!0}),(()=>pl))));else if(y.length+p.length===u){const t=y.map((e=>e.i0)).reduce(Kh);e(hu(Fc(t,im([yt(ul(b(),{parallel:!0}),(()=>pl)),...y.map((e=>e.i1))],(e=>e),r,!0,s))))}else a()}))}};for(let e=0;e<h;e++)a()})));return Bc(mu(eu(fu(i((e=>vu(eu(e.await),e.inheritAll))(v)),(()=>(S(),(e=>e.await)(v))))),(()=>su(d,(e=>e.inheritAll)))))})))))),am=(e,t,r,n)=>gu((()=>{const s=jt(e),i=new Array(s.length);return ku(im(s,((e,t)=>ou(r(e,t),(e=>i[t]=e))),n,!1,t),hu(i))})),om=e=>lm(e,Nh),cm=(e,t,r,n=null)=>um(e,t,r,n),um=(e,t,r,n=null)=>{const s=(()=>{const e=Vi(aa);return a(aa,Gi(e+1)),new ra(e,(new Date).getTime())})(),i=t.getFiberRefs(),o=xf(i,s),c=new Xp(s,o,r),u=Mf(o,Bu),l=c._supervisor;return l.onStart(u,e,ht(t),c),c.addObserver((e=>l.onEnd(e,c))),(null!==n?n:a(t.getFiberRef(Yu),yt((()=>t.scope())))).add(r,c),c},lm=(e,t)=>Lc(((r,n)=>hu(((e,t,r,n=null)=>{const s=um(e,t,r,n);return s.resume(e),s})(e,r,n.runtimeFlags,t)))),fm=e=>wl((t=>dt(vs(t,mm),{onNone:()=>e,onSome:t=>{switch(t.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return Xc(Zu(t,Ch),(t=>dm(e,t)))}}}))),hm=e=>t=>wl((r=>dt(vs(r,mm),{onNone:()=>t,onSome:r=>"ParallelN"===r.strategy._tag&&r.strategy.parallelism===e?t:Xc(Zu(r,Ah(e)),(e=>dm(t,e)))}))),gm=e=>r=>wl((n=>dt(vs(n,mm),{onNone:()=>r(t),onSome:t=>{const n="Parallel"===e._tag?fm:"Sequential"===e._tag?pm:hm(e.parallelism);switch(t.strategy._tag){case"Parallel":return n(r(fm));case"Sequential":return n(r(pm));case"ParallelN":return n(r(hm(t.strategy.parallelism)))}}}))),pm=e=>wl((t=>dt(vs(t,mm),{onNone:()=>e,onSome:t=>{switch(t.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return Xc(Zu(t,Eh),(t=>dm(e,t)))}}}))),mm=ds(Xu),dm=e(2,((e,t)=>kl(e,ks(bs(mm,t))))),ym=e=>Ku(e,{differ:qp,fork:Lp}),bm=Pu(No),_m=ym(Rp),Sm=(e,t)=>{return r=r=>Xc(Xc(om(au(e)),(e=>qc((r=>{const n=t.map((e=>e.listeners.count)),s=()=>{var t;n.every((e=>0===e))&&(i.forEach((e=>e())),r((t=e,Xc(Qc,(e=>a(t,Ou(e)))))))};e.addObserver((e=>{i.forEach((e=>e())),r(e)}));const i=t.map(((e,t)=>{const r=e=>{n[t]=e,s()};return e.listeners.addObserver(r),()=>e.listeners.removeObserver(r)}));return s(),pu((()=>{i.forEach((e=>e()))}))})))),(()=>gu((()=>{const e=t.flatMap((e=>e.state.completed?[]:[e]));return iu(e,(e=>Op(e.request,(e=>ll(Vo(e)))(r))))})))),Lc((e=>r(e.id())));var r};Symbol.iterator;Symbol.iterator;const wm=nm,vm=gu,km=bu,Om=ou,Im=zc,Nm=Xc,xm=(e,t=[])=>({value:e,forest:t}),Tm=(e,t)=>{let r="";const n=t.length;let s;for(let i=0;i<n;i++){s=t[i];const a=i===n-1;r+=e+(a?"└":"├")+"─ "+s.value,r+=Tm(e+(n>1&&!a?"│  ":"   "),s.forest)}return r},Fm=e=>{if(f(e))return JSON.stringify(e);if(h(e)||null==e||g(e)||m(e)||e instanceof Date)return String(e);if(p(e))return String(e)+"n";if(!Array.isArray(e)&&w(e,"toString")&&d(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();try{return JSON.stringify(e)}catch(t){return String(e)}},Mm=e=>br(e).pipe(bt((()=>yr(e))),bt((()=>_r(e)))),Rm=e=>{switch(e._tag){case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"UndefinedKeyword":case"SymbolKeyword":case"ObjectKeyword":case"AnyKeyword":case"UnknownKeyword":case"VoidKeyword":case"NeverKeyword":return yt(Mm(e),(()=>e._tag));case"Literal":return yt(Mm(e),(()=>Fm(e.literal)));case"UniqueSymbol":return yt(Mm(e),(()=>Fm(e.symbol)));case"Union":return[...new Set(e.types.map(Rm))].join(" or ");case"TemplateLiteral":return yt(Mm(e),(()=>(e=>e.head+e.spans.map((e=>(e=>{switch(e.type._tag){case"StringKeyword":return"${string}";case"NumberKeyword":return"${number}"}})(e)+e.literal)).join(""))(e)));case"Tuple":return yt(Mm(e),(()=>"<anonymous tuple or array schema>"));case"TypeLiteral":return yt(Mm(e),(()=>"<anonymous type literal schema>"));case"Enums":return yt(Mm(e),(()=>e.enums.map(((e,t)=>JSON.stringify(t))).join(" | ")));case"Lazy":return yt(Mm(e),(()=>"<anonymous lazy schema>"));case"Declaration":return yt(Mm(e),(()=>"<anonymous declaration schema>"));case"Refinement":return yt(Mm(e),(()=>"<anonymous refinement schema>"));case"Transform":return yt(Mm(e),(()=>`${Rm(e.from)} <-> ${Rm(e.to)}`))}},Em=(e,t)=>1===e.length&&0!==e[0].forest.length&&"UnionMember"!==t[0]._tag,Cm=e=>{switch(e._tag){case"Type":return xm((e=>dr(e.expected).pipe(wt((t=>t(e.actual))),bt((()=>e.message)),yt((()=>`Expected ${Rm(e.expected)}, actual ${Fm(e.actual)}`))))(e));case"Forbidden":return xm("is forbidden");case"Index":{const t=e.errors.map(Cm);return Em(t,e.errors)?xm(`[${e.index}]${t[0].value}`,t[0].forest):xm(`[${e.index}]`,t)}case"Unexpected":return xm("is unexpected"+(mt(e.ast)?`, expected ${Rm(e.ast.value)}`:""));case"Key":{const t=e.errors.map(Cm);return Em(t,e.errors)?xm(`[${Fm(e.key)}]${t[0].value}`,t[0].forest):xm(`[${Fm(e.key)}]`,t)}case"Missing":return xm("is missing");case"UnionMember":return xm("union member",e.errors.map(Cm))}};class Am{errors;_tag="ParseError";constructor(e){this.errors=e}toString(){return t=this.errors,(e=xm("error(s) found",t.map(Cm))).value+Tm("\n",e.forest);var e,t}toJSON(){return{_id:"ParseError",message:this.toString()}}[G](){return this.toJSON()}}const jm=e=>new Am(e),Lm=(e,t,r)=>({_tag:"Type",expected:e,actual:t,message:_t(r)}),Km={_tag:"Forbidden"},Pm=(e,t)=>({_tag:"Index",index:e,errors:t}),Bm=(e,t)=>({_tag:"Key",key:e,errors:t}),qm={_tag:"Missing"},$m=e=>({_tag:"Unexpected",ast:e}),Jm=e=>({_tag:"UnionMember",errors:e}),Um=at,Dm=e=>{const t=e;return"_tag"in t?"ParseError"===t._tag?ot(t):ot(jm([t])):ot(jm(t))},zm=e=>{const t=e;if("Left"===t._tag||"Right"===t._tag)return t},Vm=(e,t)=>{const r=e;return"Left"===r._tag?r:"Right"===r._tag?t(r.right):Nm(e,t)},Gm=(e,t)=>{const r=e;return"Left"===r._tag?r:"Right"===r._tag?at(t(r.right)):Om(e,t)},Hm=(e,t)=>{const r=Xm(e,t);return(e,t)=>r(e,{...t,isEffectAllowed:!0})},Wm={},Ym=l(Symbol.for("@effect/schema/Parser/decodeMemoMap"),(()=>new WeakMap)),Qm=l(Symbol.for("@effect/schema/Parser/encodeMemoMap"),(()=>new WeakMap)),Xm=(e,t)=>{const r=t?Ym:Qm,n=r.get(e);if(n)return n;const s=Zm(e,t);return r.set(e,s),s},Zm=(e,t)=>{switch(e._tag){case"Refinement":if(t){const t=Xm(e.from,!0);return(r,n)=>sd(Vm(t(r,n),(t=>dt(e.filter(t,n??Wm,e),{onNone:()=>Um(t),onSome:Dm}))),n)}{const t=Xm(Hr(e),!0),r=Xm(nd(e.from),!1);return(e,n)=>sd(Vm(t(e,n),(e=>r(e,n))),n)}case"Transform":{const r=ud(e.transformation,t),n=t?Xm(e.from,!0):Xm(e.to,!1),s=t?Xm(e.to,!0):Xm(e.from,!1);return(t,i)=>sd(Vm(n(t,i),(t=>Vm(r(t,i??Wm,e),(e=>s(e,i))))),i)}case"Declaration":{const r=e.decode(t,...e.typeParameters);return(t,n)=>sd(r(t,n??Wm,e),n)}case"Literal":return ed(e,(t=>t===e.literal));case"UniqueSymbol":return ed(e,(t=>t===e.symbol));case"UndefinedKeyword":case"VoidKeyword":return ed(e,y);case"NeverKeyword":return ed(e,b);case"UnknownKeyword":case"AnyKeyword":return Um;case"StringKeyword":return ed(e,f);case"NumberKeyword":return ed(e,h);case"BooleanKeyword":return ed(e,g);case"BigIntKeyword":return ed(e,p);case"SymbolKeyword":return ed(e,m);case"ObjectKeyword":return ed(e,S);case"Enums":return ed(e,(t=>e.enums.some((([e,r])=>r===t))));case"TemplateLiteral":{const t=ad(e);return ed(e,(e=>f(e)&&t.test(e)))}case"Tuple":{const r=e.elements.map((e=>Xm(e.type,t))),n=wt(e.rest,Xt((e=>Xm(e,t))));let s=e.elements.filter((e=>!e.isOptional)).length;return mt(e.rest)&&(s+=e.rest.value.length-1),(t,i)=>{if(!Array.isArray(t))return Dm(Lm(e,t));const a="all"===i?.errors,o=[];let c=0;const u=t.length;for(let e=u;e<=s-1;e++){const t=Pm(e,[qm]);if(!a)return Dm(t);o.push([c++,t])}if(pt(e.rest))for(let t=e.elements.length;t<=u-1;t++){const e=Pm(t,[$m(ft())]);if(!a)return Dm(id(od(o),e));o.push([c++,e])}const l=[];let f,h=0;for(;h<r.length;h++)if(u<h+1){if(e.elements[h].isOptional)continue}else{const e=(0,r[h])(t[h],i),n=zm(e);if(n){if(ct(n)){const e=Pm(h,n.left.errors);if(a){o.push([c++,e]);continue}return Dm(id(od(o),e))}l.push([c++,n.right])}else{const t=c++,r=h;f||(f=[]),f.push((({es:n,output:s})=>Nm(Im(e),(e=>{if(ct(e)){const s=Pm(r,e.left.errors);return a?(n.push([t,s]),km):Dm(id(od(n),s))}return s.push([t,e.right]),km}))))}}if(mt(n)){const[e,...r]=n.value;for(;h<u-r.length;h++){const r=e(t[h],i),n=zm(r);if(n){if(ct(n)){const e=Pm(h,n.left.errors);if(a){o.push([c++,e]);continue}return Dm(id(od(o),e))}l.push([c++,n.right])}else{const e=c++,t=h;f||(f=[]),f.push((({es:n,output:s})=>Nm(Im(r),(r=>{if(ct(r)){const s=Pm(t,r.left.errors);return a?(n.push([e,s]),km):Dm(id(od(n),s))}return s.push([e,r.right]),km}))))}}for(let e=0;e<r.length;e++)if(h+=e,!(u<h+1)){const n=r[e](t[h],i),s=zm(n);if(s){if(ct(s)){const e=Pm(h,s.left.errors);if(a){o.push([c++,e]);continue}return Dm(id(od(o),e))}l.push([c++,s.right])}else{const e=c++,t=h;f||(f=[]),f.push((({es:r,output:s})=>Nm(Im(n),(n=>{if(ct(n)){const s=Pm(t,n.left.errors);return a?(r.push([e,s]),km):Dm(id(od(r),s))}return s.push([e,n.right]),km}))))}}}const g=({es:e,output:t})=>Bt(e)?Dm(od(e)):Um(od(t));if(f&&f.length>0){const e=f;return vm((()=>{const t={es:Array.from(o),output:Array.from(l)};return Nm(wm(e,(e=>e(t)),{concurrency:"unbounded",discard:!0}),(()=>g(t)))}))}return g({output:l,es:o})}}case"TypeLiteral":{if(0===e.propertySignatures.length&&0===e.indexSignatures.length)return ed(e,O);const r=[],n={};for(const s of e.propertySignatures)r.push(Xm(s.type,t)),n[s.name]=null;const s=e.indexSignatures.map((e=>[Xm(e.parameter,t),Xm(e.type,t)])),i=$r(e.indexSignatures.map((e=>e.parameter)).concat(or(n).map((e=>m(e)?((e,t={})=>({_tag:"UniqueSymbol",symbol:e,annotations:t}))(e):wr(e))))),a=Xm(i,t);return(t,o)=>{if(!I(t))return Dm(Lm(e,t));const c="all"===o?.errors,u=[];let l=0;if("error"===o?.onExcessProperty)for(const e of or(t)){const t=zm(a(e,o));if(t&&ct(t)){const t=Bm(e,[$m(ht(i))]);if(c){u.push([l++,t]);continue}return Dm(id(od(u),t))}}const f={};let h;for(let n=0;n<r.length;n++){const s=e.propertySignatures[n],i=r[n],a=s.name;if(Object.prototype.hasOwnProperty.call(t,a)){const e=i(t[a],o),r=zm(e);if(r){if(ct(r)){const e=Bm(a,r.left.errors);if(c){u.push([l++,e]);continue}return Dm(id(od(u),e))}f[a]=r.right}else{const t=l++,r=a;h||(h=[]),h.push((({es:n,output:s})=>Nm(Im(e),(e=>{if(ct(e)){const s=Bm(r,e.left.errors);return c?(n.push([t,s]),km):Dm(id(od(n),s))}return s[r]=e.right,km}))))}}else if(!s.isOptional){const e=Bm(a,[qm]);if(c){u.push([l++,e]);continue}return Dm(e)}}for(let r=0;r<s.length;r++){const i=s[r],a=i[0],g=i[1],p=ar(t,e.indexSignatures[r].parameter);for(const e of p){const r=zm(a(e,o));if(r&&ut(r)){const r=g(t[e],o),s=zm(r);if(s){if(ct(s)){const t=Bm(e,s.left.errors);if(c){u.push([l++,t]);continue}return Dm(id(od(u),t))}Object.prototype.hasOwnProperty.call(n,e)||(f[e]=s.right)}else{const t=l++,s=e;h||(h=[]),h.push((({es:i,output:a})=>Nm(Im(r),(r=>{if(ct(r)){const e=Bm(s,r.left.errors);return c?(i.push([t,e]),km):Dm(id(od(i),e))}return Object.prototype.hasOwnProperty.call(n,e)||(a[e]=r.right),km}))))}}}}const g=({es:e,output:t})=>Bt(e)?Dm(od(e)):Um(t);if(h&&h.length>0){const e=h;return vm((()=>{const t={es:Array.from(u),output:Object.assign({},f)};return Nm(wm(e,(e=>e(t)),{concurrency:"unbounded",discard:!0}),(()=>g(t)))}))}return g({es:u,output:f})}}case"Union":{const r=rd(e.types,t),n=or(r.keys),s=n.length,i=new Map;for(let r=0;r<e.types.length;r++)i.set(e.types[r],Xm(e.types[r],t));return(t,a)=>{const o=[];let c,u=0,l=[];if(s>0)if(I(t))for(let e=0;e<s;e++){const s=n[e],i=r.keys[s].buckets;if(Object.prototype.hasOwnProperty.call(t,s)){const e=String(t[s]);Object.prototype.hasOwnProperty.call(i,e)?l=l.concat(i[e]):o.push([u++,Bm(s,[Lm(r.keys[s].ast,t[s])])])}else o.push([u++,Bm(s,[qm])])}else o.push([u++,Lm(e,t)]);r.otherwise.length>0&&(l=l.concat(r.otherwise));for(let e=0;e<l.length;e++){const r=i.get(l[e])(t,a),n=c&&0!==c.length?void 0:zm(r);if(n){if(ut(n))return Um(n.right);o.push([u++,Jm(n.left.errors)])}else{const e=u++;c||(c=[]),c.push((t=>vm((()=>"finalResult"in t?km:Nm(Im(r),(r=>(ut(r)?t.finalResult=Um(r.right):t.es.push([e,Jm(r.left.errors)]),km)))))))}}const f=e=>Bt(e)?Dm(od(e)):Dm(Lm(kr,t));if(c&&c.length>0){const e=c;return vm((()=>{const t={es:Array.from(o)};return Nm(wm(e,(e=>e(t)),{concurrency:1,discard:!0}),(()=>"finalResult"in t?t.finalResult:f(t.es)))}))}return f(o)}}case"Lazy":{const r=cr((()=>Xm(e.f(),t)));return(e,t)=>r()(e,t)}}},ed=(e,t)=>r=>t(r)?Um(r):Dm(Lm(e,r)),td=(e,t)=>{switch(e._tag){case"Declaration":return td(e.type,t);case"TypeLiteral":{const r=[];for(let n=0;n<e.propertySignatures.length;n++){const s=e.propertySignatures[n],i=t?Wr(s.type):Hr(s.type);vr(i)&&!s.isOptional&&r.push([s.name,i])}return r}case"Refinement":return td(e.from,t);case"Transform":return td(t?e.from:e.to,t)}return[]},rd=(e,t)=>{const r={},n=[];for(let s=0;s<e.length;s++){const i=e[s],a=td(i,t);if(a.length>0)for(let e=0;e<a.length;e++){const[t,n]=a[e],s=String(n.literal);r[t]=r[t]||{buckets:{},ast:kr};const o=r[t].buckets;if(!Object.prototype.hasOwnProperty.call(o,s)){o[s]=[i],r[t].ast=$r([r[t].ast,n]);break}e<a.length-1||(o[s].push(i),r[t].ast=$r([r[t].ast,n]))}else n.push(i)}return{keys:r,otherwise:n}},nd=e=>(e=>"Refinement"===e._tag)(e)?nd(e.from):e,sd=(e,t)=>zm(e)||(!0===t?.isEffectAllowed?e:Dm(Km)),id=(e,t)=>(e.push(t),e),ad=e=>{let t=`^${e.head}`;for(const r of e.spans)Fr(r.type)?t+=".*":Rr(r.type)&&(t+="[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?"),t+=r.literal;return t+="$",new RegExp(t)};function od(e){return e.sort((([e],[t])=>e>t?1:e<t?-1:0)).map((([e,t])=>t))}const cd=(e,t)=>{if("FinalPropertySignatureTransformation"===e._tag)return t?e.decode:e.encode},ud=(e,t)=>{switch(e._tag){case"FinalTransformation":return t?e.decode:e.encode;case"ComposeTransformation":return Um;case"TypeLiteralTransformation":return r=>{let n=at(r);for(const r of e.propertySignatureTransformations){const[e,s]=t?[r.from,r.to]:[r.to,r.from],i=cd(r.propertySignatureTransformation,t),a=t=>{const r=i(Object.prototype.hasOwnProperty.call(t,e)?ht(t[e]):ft());return delete t[e],mt(r)&&(t[s]=r.value),t};n=Gm(n,a)}return n}}},ld=(e,t,r,n)=>(n.isLazy?e.oneof({depthSize:1},e.constant([]),e.array(e.tuple(t,r),{minLength:1,maxLength:2})):e.array(e.tuple(t,r))).map((e=>{const t={};for(const[r,n]of e)t[r]=n;return t})),fd=mr(kn),hd=(e,t)=>{switch(e._tag){case"Declaration":return a(fd(e),dt({onNone:()=>hd(e.type,t),onSome:r=>r(...e.typeParameters.map((e=>hd(e,t))))}));case"Literal":return t=>t.constant(e.literal);case"UniqueSymbol":return t=>t.constant(e.symbol);case"UndefinedKeyword":case"VoidKeyword":return e=>e.constant(void 0);case"NeverKeyword":return()=>{throw new Error("cannot build an Arbitrary for `never`")};case"UnknownKeyword":case"AnyKeyword":return e=>e.anything();case"StringKeyword":return e=>t.constraints&&"StringConstraints"===t.constraints._tag?e.string(t.constraints.constraints):e.string();case"NumberKeyword":return e=>{if(t.constraints)switch(t.constraints._tag){case"NumberConstraints":return e.float(t.constraints.constraints);case"IntegerConstraints":return e.integer(t.constraints.constraints)}return e.float()};case"BooleanKeyword":return e=>e.boolean();case"BigIntKeyword":return e=>t.constraints&&"BigIntConstraints"===t.constraints._tag?e.bigInt(t.constraints.constraints):e.bigInt();case"SymbolKeyword":return e=>e.string().map((e=>Symbol.for(e)));case"ObjectKeyword":return e=>e.oneof(e.object(),e.array(e.anything()));case"TemplateLiteral":return t=>{const r=t.string({maxLength:5}),n=t.float({noDefaultInfinity:!0}).filter((e=>!Number.isNaN(e))),s=[t.constant(e.head)];for(const i of e.spans)Fr(i.type)?s.push(r):s.push(n),s.push(t.constant(i.literal));return t.tuple(...s).map((e=>e.join("")))};case"Tuple":{const r=[];let n=!1;for(const s of e.elements)r.push(hd(s.type,t)),s.isOptional&&(n=!0);const s=wt(e.rest,Xt((e=>hd(e,t))));return i=>{let a=i.tuple(...r.map((e=>e(i))));if(n){const t=i.tuple(...e.elements.map((e=>e.isOptional?i.boolean():i.constant(!0))));a=a.chain((e=>t.map((t=>{for(const[r,n]of t.reverse().entries())n||e.splice(t.length-r,1);return e}))))}if(mt(s)){const[e,...r]=s.value,n=e(i),o=t.constraints;a=a.chain((e=>{let r=i.array(n);return t.isLazy?r=i.oneof({depthSize:1},i.constant([]),i.array(n,{minLength:1,maxLength:2})):o&&"ArrayConstraints"===o._tag&&(r=i.array(n,o.constraints)),r.map((t=>[...e,...t]))}));for(let e=0;e<r.length;e++)a=a.chain((t=>r[e](i).map((e=>[...t,e]))))}return a}}case"TypeLiteral":{const r=e.propertySignatures.map((e=>hd(e.type,t))),n=e.indexSignatures.map((e=>[hd(e.parameter,t),hd(e.type,t)]));return s=>{const i={},a=[];for(let t=0;t<r.length;t++){const n=e.propertySignatures[t],o=n.name;n.isOptional||a.push(o),i[o]=r[t](s)}let o=s.record(i,{requiredKeys:a});for(let e=0;e<n.length;e++){const r=n[e][0](s),i=n[e][1](s);o=o.chain((e=>ld(s,r,i,t).map((t=>({...t,...e})))))}return o}}case"Union":{const r=e.types.map((e=>hd(e,t)));return e=>e.oneof({depthSize:1},...r.map((t=>t(e))))}case"Enums":if(0===e.enums.length)throw new Error("cannot build an Arbitrary for an empty enum");return t=>t.oneof(...e.enums.map((([e,r])=>t.constant(r))));case"Refinement":{const r=_d(t.constraints,bd(e)),n=hd(e.from,r?{...t,constraints:r}:t);return a(fd(e),dt({onNone:()=>t=>n(t).filter((t=>pt(e.filter(t,Wm,e)))),onSome:e=>e(n)}))}case"Lazy":return a(fd(e),dt({onNone:()=>{const r=cr((()=>hd(e.f(),{...t,isLazy:!0})));return e=>e.constant(null).chain((()=>r()(e)))},onSome:e=>e()}));case"Transform":throw new Error("cannot build an Arbitrary for transformations")}},gd=e=>(h(e.min)&&(e.min=Math.fround(e.min)),h(e.max)&&(e.max=Math.fround(e.max)),{_tag:"NumberConstraints",constraints:e}),pd=e=>({_tag:"StringConstraints",constraints:e}),md=e=>({_tag:"IntegerConstraints",constraints:e}),dd=e=>({_tag:"ArrayConstraints",constraints:e}),yd=e=>({_tag:"BigIntConstraints",constraints:e}),bd=e=>{const t=e.annotations[ur],r=e.annotations[pr];switch(t){case an:case on:return gd({min:r.exclusiveMinimum??r.minimum});case cn:case un:return gd({max:r.exclusiveMaximum??r.maximum});case ln:return md({});case fn:{const e=r.minimum,t=r.maximum,n={};return h(e)&&(n.min=e),h(t)&&(n.max=t),gd(n)}case hn:case gn:{const r=e.annotations[t];return yd({min:r.min})}case pn:case mn:{const r=e.annotations[t];return yd({max:r.max})}case dn:{const r=e.annotations[t],n=r.min,s=r.max,i={};return p(n)&&(i.min=n),p(s)&&(i.max=s),yd(i)}case yn:return pd({minLength:r.minLength});case bn:return pd({maxLength:r.maxLength});case _n:return pd({minLength:r.minLength,maxLength:r.maxLength});case Sn:return dd({minLength:r.minItems});case wn:return dd({maxLength:r.maxItems});case vn:return dd({minLength:r.minItems,maxLength:r.maxItems})}},_d=(e,t)=>{if(void 0===e)return t;if(void 0===t)return e;switch(e._tag){case"ArrayConstraints":if("ArrayConstraints"===t._tag){const r={...e.constraints,...t.constraints},n=Sd(e.constraints.minLength,t.constraints.minLength);h(n)&&(r.minLength=n);const s=wd(e.constraints.maxLength,t.constraints.maxLength);return h(s)&&(r.maxLength=s),dd(r)}break;case"NumberConstraints":switch(t._tag){case"NumberConstraints":{const r={...e.constraints,...t.constraints},n=Sd(e.constraints.min,t.constraints.min);h(n)&&(r.min=n);const s=wd(e.constraints.max,t.constraints.max);return h(s)&&(r.max=s),gd(r)}case"IntegerConstraints":{const r={...t.constraints},n=Sd(e.constraints.min,t.constraints.min);h(n)&&(r.min=n);const s=wd(e.constraints.max,t.constraints.max);return h(s)&&(r.max=s),md(r)}}break;case"BigIntConstraints":if("BigIntConstraints"===t._tag){const r={...e.constraints,...t.constraints},n=Sd(e.constraints.min,t.constraints.min);p(n)&&(r.min=n);const s=wd(e.constraints.max,t.constraints.max);return p(s)&&(r.max=s),yd(r)}break;case"StringConstraints":if("StringConstraints"===t._tag){const r={...e.constraints,...t.constraints},n=Sd(e.constraints.minLength,t.constraints.minLength);h(n)&&(r.minLength=n);const s=wd(e.constraints.maxLength,t.constraints.maxLength);return h(s)&&(r.maxLength=s),pd(r)}break;case"IntegerConstraints":switch(t._tag){case"NumberConstraints":case"IntegerConstraints":{const r={...e.constraints},n=Sd(e.constraints.min,t.constraints.min);h(n)&&(r.min=n);const s=wd(e.constraints.max,t.constraints.max);return h(s)&&(r.max=s),md(r)}}}};function Sd(e,t){return void 0===e?t:void 0===t?e:e<=t?t:e}function wd(e,t){return void 0===e?t:void 0===t||e<=t?e:t}const vd=Symbol.for("@effect/schema/Schema"),kd={From:e=>e,To:e=>e};class Od{ast;[vd]=kd;constructor(e){this.ast=e}pipe(){return Y(this,arguments)}}const Id=e=>new Od(e),Nd=(...e)=>Td(...e.map((e=>Id(wr(e))))),xd=Id(Nr),Td=(...e)=>Id($r(e.map((e=>e.ast)))),Fd=e=>{const r=or(e),n=[],s=[],i=[],a=[];for(let o=0;o<r.length;o++){const c=r[o],u=e[c];if("config"in u){const e=u.config,r=e.ast,o=Hr(r),l=e.annotations;switch(e._tag){case"PropertySignature":n.push(Kr(c,r,!1,!0,l)),s.push(Kr(c,r,!1,!0)),i.push(Kr(c,o,!1,!0,l));break;case"Optional":n.push(Kr(c,r,!0,!0,l)),s.push(Kr(c,r,!0,!0)),i.push(Kr(c,o,!0,!0,l));break;case"Default":s.push(Kr(c,r,!0,!0)),i.push(Kr(c,o,!1,!0,l)),a.push(Gr(c,c,Vr(bt((()=>ht(e.value()))),t)));break;case"Option":s.push(Kr(c,r,!0,!0)),i.push(Kr(c,Ad(Id(o)).ast,!1,!0,l)),a.push(Gr(c,c,Vr(ht,kt)))}}else n.push(Kr(c,u.ast,!1,!0)),s.push(Kr(c,u.ast,!1,!0)),i.push(Kr(c,Hr(u.ast),!1,!0))}return qt(a)?Id(Dr(qr(s,[]),qr(i,[]),(e=>{const t={};for(const r of e){const e=r.from;if(t[e])throw new Error(`Duplicate property signature transformation ${String(e)}`);t[e]=!0}return{_tag:"TypeLiteralTransformation",propertySignatureTransformations:e}})(a))):Id(qr(n,[]))},Md=e=>Td(Fd({_tag:Nd("None")}),Fd({_tag:Nd("Some"),value:e})),Rd=e=>"None"===e._tag?ft():ht(e.value),Ed=e=>{const t=((e,t)=>Id(Jr((()=>e().ast),t)))((()=>xd)).pipe((e=>t=>Id(((e,t)=>({...e,annotations:{...e.annotations,...t}}))(t.ast,e)))({[kn]:()=>e})),r=(n=Md(t),hd(n.ast,{}));var n;return e=>r(e).map(Rd)},Cd=e=>dt({onNone:()=>"none()",onSome:t=>`some(${e(t)})`}),Ad=e=>((e,t,r,n)=>Id(Sr(e.map((e=>e.ast)),t.ast,((e,...t)=>r(e,...t.map(Id))),n)))([e],Md(e),((e,t)=>{const r=e?Hm(t.ast,!0):Hm(t.ast,!1);return(e,t,n)=>gt(e)?pt(e)?Um(ft()):Gm(r(e.value,t),ht):Dm(Lm(n,e))}),{[fr]:"Option",[On]:Cd,[kn]:Ed,[In]:Ot});var jd,Ld,Kd=(jd=Fd({name:Id(Tr),age:Id(Mr)}),Ld=jd.ast,Xm(Ld,!0)),Pd=Kd({name:"Alice",age:30});ut(Pd)&&console.log(Pd.right);var Bd=Kd(null);ct(Bd)&&console.log(Bd.left)})();